import{_ as t}from"./plugin-vue_export-helper-DlAUqK2U.js";import{c as a,e as r,o as n}from"./app-f_uNzTRF.js";const l={};function i(s,e){return n(),a("div",null,e[0]||(e[0]=[r('<h2 id="证书续期提示" tabindex="-1"><a class="header-anchor" href="#证书续期提示"><span>证书续期提示</span></a></h2><ul><li>当执行<code>kubectl get nodes</code>等提示 Unable to connect to the server: x509: certificate has expired or is not yet valid 既为k8s的证书到期的提示 使用kubeadm安装k8s时，默认生成的client certificate的有效期是1年。</li></ul><h2 id="续期" tabindex="-1"><a class="header-anchor" href="#续期"><span>续期</span></a></h2><p>master节点：xxx.xxx.xxx.xxx</p><h3 id="检查证书有效期" tabindex="-1"><a class="header-anchor" href="#检查证书有效期"><span>检查证书有效期</span></a></h3><p>kubeadm alpha certs check-expiration 或 openssl x509 -in /etc/kubernetes/pki/apiserver.crt -noout -text |grep &#39; Not &#39;</p><h3 id="备份证书" tabindex="-1"><a class="header-anchor" href="#备份证书"><span>备份证书</span></a></h3><p>cp -rp /etc/kubernetes /etc/kubernetes.bak</p><h3 id="重新生成证书" tabindex="-1"><a class="header-anchor" href="#重新生成证书"><span>重新生成证书</span></a></h3><p>kubeadm alpha certs renew all</p><h3 id="更新用户凭证" tabindex="-1"><a class="header-anchor" href="#更新用户凭证"><span>更新用户凭证</span></a></h3><p>cp /etc/kubernetes/admin.conf ~/.kube/config -f</p><h3 id="重启kubelet" tabindex="-1"><a class="header-anchor" href="#重启kubelet"><span>重启kubelet</span></a></h3><p>systemctl restart kubelet</p><h3 id="重启apiserver-scheduler-controller-manager-容器" tabindex="-1"><a class="header-anchor" href="#重启apiserver-scheduler-controller-manager-容器"><span>重启apiserver，scheduler，controller-manager 容器</span></a></h3><p>docker ps |grep -E &#39;k8s_kube-apiserver|k8s_kube-controller-manager|k8s_kube-scheduler|k8s_etcd_etcd&#39;|xargs docker restart</p><h3 id="检测" tabindex="-1"><a class="header-anchor" href="#检测"><span>检测</span></a></h3><p>systemctl status kubelet</p><p>kubectl get nodes</p><h3 id="其他节点更新配置" tabindex="-1"><a class="header-anchor" href="#其他节点更新配置"><span>其他节点更新配置</span></a></h3><p>scp root@masterIP:/etc/kubernetes/admin.conf /etc/kubernetes/ &amp;&amp; cp /etc/kubernetes/admin.conf ~/.kube/config -f 或者拷贝到其他节点</p>',21)]))}const p=t(l,[["render",i],["__file","k8s_certificate_expire_handle.html.vue"]]),d=JSON.parse(`{"path":"/posts/developer/k8s_certificate_expire_handle.html","title":"k8s证书到期处理","lang":"zh-CN","frontmatter":{"title":"k8s证书到期处理","date":"2022-04-02T14:09:00.000Z","category":["Developer"],"tag":["k8s"],"description":"证书续期提示 当执行kubectl get nodes等提示 Unable to connect to the server: x509: certificate has expired or is not yet valid 既为k8s的证书到期的提示 使用kubeadm安装k8s时，默认生成的client certificate的有效期是1年。 续...","head":[["meta",{"property":"og:url","content":"https://www.yimo.link/posts/developer/k8s_certificate_expire_handle.html"}],["meta",{"property":"og:site_name","content":"易墨网"}],["meta",{"property":"og:title","content":"k8s证书到期处理"}],["meta",{"property":"og:description","content":"证书续期提示 当执行kubectl get nodes等提示 Unable to connect to the server: x509: certificate has expired or is not yet valid 既为k8s的证书到期的提示 使用kubeadm安装k8s时，默认生成的client certificate的有效期是1年。 续..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2024-10-28T11:15:42.000Z"}],["meta",{"property":"article:tag","content":"k8s"}],["meta",{"property":"article:published_time","content":"2022-04-02T14:09:00.000Z"}],["meta",{"property":"article:modified_time","content":"2024-10-28T11:15:42.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"k8s证书到期处理\\",\\"image\\":[\\"\\"],\\"datePublished\\":\\"2022-04-02T14:09:00.000Z\\",\\"dateModified\\":\\"2024-10-28T11:15:42.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"易墨\\",\\"url\\":\\"https://www.yimo.link\\"}]}"]]},"headers":[{"level":2,"title":"证书续期提示","slug":"证书续期提示","link":"#证书续期提示","children":[]},{"level":2,"title":"续期","slug":"续期","link":"#续期","children":[{"level":3,"title":"检查证书有效期","slug":"检查证书有效期","link":"#检查证书有效期","children":[]},{"level":3,"title":"备份证书","slug":"备份证书","link":"#备份证书","children":[]},{"level":3,"title":"重新生成证书","slug":"重新生成证书","link":"#重新生成证书","children":[]},{"level":3,"title":"更新用户凭证","slug":"更新用户凭证","link":"#更新用户凭证","children":[]},{"level":3,"title":"重启kubelet","slug":"重启kubelet","link":"#重启kubelet","children":[]},{"level":3,"title":"重启apiserver，scheduler，controller-manager 容器","slug":"重启apiserver-scheduler-controller-manager-容器","link":"#重启apiserver-scheduler-controller-manager-容器","children":[]},{"level":3,"title":"检测","slug":"检测","link":"#检测","children":[]},{"level":3,"title":"其他节点更新配置","slug":"其他节点更新配置","link":"#其他节点更新配置","children":[]}]}],"git":{"createdTime":1730114142000,"updatedTime":1730114142000,"contributors":[{"name":"yimo","email":"yimo@wikiglobal.com","commits":1}]},"readingTime":{"minutes":0.66,"words":199},"filePathRelative":"posts/developer/k8s_certificate_expire_handle.md","localizedDate":"2022年4月2日","excerpt":"<h2>证书续期提示</h2>\\n<ul>\\n<li>当执行<code>kubectl get nodes</code>等提示 Unable to connect to the server: x509: certificate has expired or is not yet valid 既为k8s的证书到期的提示\\n使用kubeadm安装k8s时，默认生成的client certificate的有效期是1年。</li>\\n</ul>\\n<h2>续期</h2>\\n<p>master节点：xxx.xxx.xxx.xxx</p>\\n<h3>检查证书有效期</h3>\\n<p>kubeadm alpha certs check-expiration\\n或\\nopenssl x509 -in /etc/kubernetes/pki/apiserver.crt -noout -text |grep ' Not '</p>","autoDesc":true}`);export{p as comp,d as data};
