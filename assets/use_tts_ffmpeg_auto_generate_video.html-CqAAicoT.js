import{_ as n}from"./plugin-vue_export-helper-DlAUqK2U.js";import{c as a,e as s,o as t}from"./app-CS3knfL2.js";const i="/assets/662652-20220227185622138-105507853-CJ0fNfD8.png",l="/assets/662652-20220227185638547-2069396514-CqaTKA6R.png",p="/assets/662652-20220227185545943-885834419-YotiNbO5.png",o="/assets/662652-20220227185651597-1278399385-Dx8-gDCY.png",r={};function c(d,e){return t(),a("div",null,e[0]||(e[0]=[s('<h2 id="参考" tabindex="-1"><a class="header-anchor" href="#参考"><span>参考</span></a></h2><ul><li><a href="https://www.ffmpeg.org/" target="_blank" rel="noopener noreferrer">FFmpeg</a></li><li><a href="https://www.xfyun.cn/doc/tts/offline_tts/Windows-SDK.html" target="_blank" rel="noopener noreferrer">讯飞离线语音合成</a></li></ul><h2 id="起因" tabindex="-1"><a class="header-anchor" href="#起因"><span>起因</span></a></h2><blockquote><p>某日，看到一个营销号的视频说做视频日进斗金，大意是用软件识别文章小说，搭配一些图片转换成自己的视频。看完当时脑海里冒出一个念头，我也可以，于是有了这番尝试。</p></blockquote><h2 id="方案" tabindex="-1"><a class="header-anchor" href="#方案"><span>方案</span></a></h2><blockquote><p>首先文字方面，我选择了【聚合数据的笑话接口】(https://www.juhe.cn/docs/api/id/95),就不需要费力去自己找资源了 其次需要将文字转换为音频，我选择了【讯飞的语音合成】，因为其有<a href="https://www.xfyun.cn/doc/tts/offline_tts/Windows-SDK.html" target="_blank" rel="noopener noreferrer">Windows离线版SDK</a>，修改了一些就可以根据需要使用了 最后是音频转视频方面，采用了【FFmpeg】，为视频添加了封面图与滚动字幕</p></blockquote><h2 id="使用脚本实现自动生成视频" tabindex="-1"><a class="header-anchor" href="#使用脚本实现自动生成视频"><span>使用脚本实现自动生成视频</span></a></h2><h3 id="准备笑话文本" tabindex="-1"><a class="header-anchor" href="#准备笑话文本"><span>准备笑话文本</span></a></h3><blockquote><p>将笑话文本复制保存到一个文本中即可</p></blockquote><h3 id="下载讯飞语音合成离线包" tabindex="-1"><a class="header-anchor" href="#下载讯飞语音合成离线包"><span>下载讯飞语音合成离线包</span></a></h3><ul><li>需要注册并身份认证后在控制台下载，<a href="https://console.xfyun.cn/services/aisound" target="_blank" rel="noopener noreferrer">下载地址</a></li><li>安装文档中使用vs运行samples中的解决方案(使用的是VS2010)，若项目加载失败则升级下项目的框架版本：项目右键-&gt;重定向项目-&gt;安装最新版本即可。</li></ul><figure><img src="'+i+'" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><ul><li>为了能够在后续可以直接调用sdk，则根据需要改动此示例即可,此处改动了入参和退出。</li></ul><figure><img src="'+l+'" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>重新生成后，找到外层bin目录下的exe，就可以直接使用<code>tts_offline_sample hello.wav &quot;hello word&quot;</code>调用程序合成文本音频到指定路径。</p><figure><img src="'+p+'" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>将bin和libs目录拷贝到需要的地方，或者将bin目录添加到环境变量中，就可以在任意地方使用了</p><h3 id="下载ffmpeg" tabindex="-1"><a class="header-anchor" href="#下载ffmpeg"><span>下载ffmpeg</span></a></h3><p>现在已经使用tts生成了音频文件，接下来使用 ffmpeg 将音频转换为视频并且生成字幕即可得到一个新鲜出炉的视频了 <a href="https://www.gyan.dev/ffmpeg/builds/ffmpeg-release-full.7z" target="_blank" rel="noopener noreferrer">ffmpeg下载地址</a> 下载解压后将ffmpeg所在目录设置到环境变量，这样就可以在任意地方使用</p><h3 id="生成视频" tabindex="-1"><a class="header-anchor" href="#生成视频"><span>生成视频</span></a></h3><p>先从pixabay获取一个无版权的素材图片保存为 cover.jpg 作为封面，执行以下命令即可生成视频</p><p><code>ffmpeg -y -loop 1 -i cover.jpg -i hello.wav -c:v libx264 -c:a aac -b:a 192k -shortest hello.mp4</code></p><figure><img src="'+o+`" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><h3 id="生成滚动字幕" tabindex="-1"><a class="header-anchor" href="#生成滚动字幕"><span>生成滚动字幕</span></a></h3><p>创建一个content.txt文件，写入内容“hello word，你好世界” x,y为坐标，根据需要调整即可，fontfile设置为中文字体，不设置，中文将会乱码，执行命令后即可得到一个带滚动字幕的视频。</p><p><code>ffmpeg -y -i hello.mp4 -vf &quot;drawtext=fontfile=C\\\\:/Windows/Fonts/msyh.ttc:fontcolor=ffcc00:fontsize=40:shadowx=2:shadowy=2:textfile=./content.txt:reload=1:y=h/5:x=w-(mod(8*n\\,w+tw)-tw/100)&quot; -c:a copy hellofull.mp4</code></p><p>注意vf参数中的路径需要特殊处理，<code>Replace(&quot;\\\\&quot;, &quot;/&quot;).Replace(&quot;:&quot;, &quot;\\\\:&quot;)</code></p><p>自此，技术点已经说明完毕，后续的就是一些优化和脚本的组合了。</p><h3 id="图片转视频" tabindex="-1"><a class="header-anchor" href="#图片转视频"><span>图片转视频</span></a></h3><blockquote><p>注意：./ 为图片目录，且 img_ 为前缀,%03d 为格式( C语言中的格式化输出 %0nd )，不足3位长度的左补齐0，即必须为img_001,img_002这种格式，并且图片需要从第一张图片开始的序号开始依次排列，图片后缀与其格式需要一致。否则都不能成功 以下命令正确执行文件名需要为：img_001.png,img_002.png,img_003.png... -r 0.500 ，1/0.500= 2秒 一张图片显示 -y 覆盖生成的文件 <code>ffmpeg -y -r 0.500 -i ./img_%03d.png ./output.mp4</code></p></blockquote><h2 id="完整脚本" tabindex="-1"><a class="header-anchor" href="#完整脚本"><span>完整脚本</span></a></h2><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>set coverPath=F:\\\\Project\\\\JokeBox\\\\cover.jpg</span></span>
<span class="line"><span>set contentPath=F:\\\\Project\\\\JokeBox\\\\content.txt</span></span>
<span class="line"><span>set /P jokeContent=&lt;%contentPath%</span></span>
<span class="line"><span>set videoName=video%date:~0,4%%date:~5,2%%date:~8,2%0%time:~1,1%%time:~3,2%%time:~6,2%</span></span>
<span class="line"><span>set outDic=F:\\\\Project\\\\JokeBox\\\\output\\\\%videoName%</span></span>
<span class="line"><span>set voicePath=%outDic%\\\\voice.wav</span></span>
<span class="line"><span>set videoPath=%outDic%\\\\video.mp4</span></span>
<span class="line"><span>set videoFullPath=%outDic%\\\\每日笑话-%date:~5,2%-%date:~8,2%.mp4</span></span>
<span class="line"><span>set srtPath=F\\\\:/Project/JokeBox/zimu.txt</span></span>
<span class="line"><span></span></span>
<span class="line"><span>echo 音频：%voicePath% </span></span>
<span class="line"><span>echo 视频：%videoPath%</span></span>
<span class="line"><span>echo 字幕：%srtPath%</span></span>
<span class="line"><span>echo 文本：%jokeContent%</span></span>
<span class="line"><span></span></span>
<span class="line"><span>echo 创建输出目录</span></span>
<span class="line"><span>mkdir %outDic%</span></span>
<span class="line"><span></span></span>
<span class="line"><span>echo 生成音频</span></span>
<span class="line"><span>tts_offline_sample.exe &quot;%voicePath%&quot; &quot;%jokeContent%&quot;</span></span>
<span class="line"><span></span></span>
<span class="line"><span>echo 生成视频</span></span>
<span class="line"><span>ffmpeg -loop 1 -i %coverPath% -i %voicePath%  -c:v libx264 -c:a aac -b:a 192k -shortest %videoPath%</span></span>
<span class="line"><span></span></span>
<span class="line"><span>echo 生成字幕</span></span>
<span class="line"><span>ffmpeg -y -i %videoPath% -vf &quot;drawtext=fontfile=C\\\\:/Windows/Fonts/msyh.ttc:fontcolor=ffcc00:fontsize=40:shadowx=2:shadowy=2:textfile=%srtPath%:reload=1:y=h/5:x=w-(mod(8*n\\,w+tw)-tw/100)&quot;  -c:a copy %videoFullPath%</span></span>
<span class="line"><span></span></span>
<span class="line"><span>copy %contentPath% %outDic%</span></span>
<span class="line"><span></span></span>
<span class="line"><span>echo 移除音频视频</span></span>
<span class="line"><span>del %voicePath:\\\\=\\%</span></span>
<span class="line"><span>del %videoPath:\\\\=\\%</span></span>
<span class="line"><span></span></span>
<span class="line"><span>pause</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,32)]))}const f=n(r,[["render",c],["__file","use_tts_ffmpeg_auto_generate_video.html.vue"]]),u=JSON.parse('{"path":"/posts/developer/use_tts_ffmpeg_auto_generate_video.html","title":"使用讯飞tts+ffmpeg自动生成视频","lang":"zh-CN","frontmatter":{"title":"使用讯飞tts+ffmpeg自动生成视频","date":"2022-02-27T18:59:00.000Z","category":["Developer"],"tag":["winform","脚本"],"description":"参考 FFmpeg 讯飞离线语音合成 起因 某日，看到一个营销号的视频说做视频日进斗金，大意是用软件识别文章小说，搭配一些图片转换成自己的视频。看完当时脑海里冒出一个念头，我也可以，于是有了这番尝试。 方案 首先文字方面，我选择了【聚合数据的笑话接口】(https://www.juhe.cn/docs/api/id/95),就不需要费力去自己找资源了 ...","head":[["meta",{"property":"og:url","content":"https://www.yimo.link/posts/developer/use_tts_ffmpeg_auto_generate_video.html"}],["meta",{"property":"og:site_name","content":"易墨网"}],["meta",{"property":"og:title","content":"使用讯飞tts+ffmpeg自动生成视频"}],["meta",{"property":"og:description","content":"参考 FFmpeg 讯飞离线语音合成 起因 某日，看到一个营销号的视频说做视频日进斗金，大意是用软件识别文章小说，搭配一些图片转换成自己的视频。看完当时脑海里冒出一个念头，我也可以，于是有了这番尝试。 方案 首先文字方面，我选择了【聚合数据的笑话接口】(https://www.juhe.cn/docs/api/id/95),就不需要费力去自己找资源了 ..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2024-10-28T11:15:42.000Z"}],["meta",{"property":"article:tag","content":"winform"}],["meta",{"property":"article:tag","content":"脚本"}],["meta",{"property":"article:published_time","content":"2022-02-27T18:59:00.000Z"}],["meta",{"property":"article:modified_time","content":"2024-10-28T11:15:42.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"使用讯飞tts+ffmpeg自动生成视频\\",\\"image\\":[\\"\\"],\\"datePublished\\":\\"2022-02-27T18:59:00.000Z\\",\\"dateModified\\":\\"2024-10-28T11:15:42.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"易墨\\",\\"url\\":\\"https://www.yimo.link\\"}]}"]]},"headers":[{"level":2,"title":"参考","slug":"参考","link":"#参考","children":[]},{"level":2,"title":"起因","slug":"起因","link":"#起因","children":[]},{"level":2,"title":"方案","slug":"方案","link":"#方案","children":[]},{"level":2,"title":"使用脚本实现自动生成视频","slug":"使用脚本实现自动生成视频","link":"#使用脚本实现自动生成视频","children":[{"level":3,"title":"准备笑话文本","slug":"准备笑话文本","link":"#准备笑话文本","children":[]},{"level":3,"title":"下载讯飞语音合成离线包","slug":"下载讯飞语音合成离线包","link":"#下载讯飞语音合成离线包","children":[]},{"level":3,"title":"下载ffmpeg","slug":"下载ffmpeg","link":"#下载ffmpeg","children":[]},{"level":3,"title":"生成视频","slug":"生成视频","link":"#生成视频","children":[]},{"level":3,"title":"生成滚动字幕","slug":"生成滚动字幕","link":"#生成滚动字幕","children":[]},{"level":3,"title":"图片转视频","slug":"图片转视频","link":"#图片转视频","children":[]}]},{"level":2,"title":"完整脚本","slug":"完整脚本","link":"#完整脚本","children":[]}],"git":{"createdTime":1730114142000,"updatedTime":1730114142000,"contributors":[{"name":"yimo","email":"yimo@wikiglobal.com","commits":1}]},"readingTime":{"minutes":3.69,"words":1108},"filePathRelative":"posts/developer/use_tts_ffmpeg_auto_generate_video.md","localizedDate":"2022年2月27日","excerpt":"<h2>参考</h2>\\n<ul>\\n<li><a href=\\"https://www.ffmpeg.org/\\" target=\\"_blank\\" rel=\\"noopener noreferrer\\">FFmpeg</a></li>\\n<li><a href=\\"https://www.xfyun.cn/doc/tts/offline_tts/Windows-SDK.html\\" target=\\"_blank\\" rel=\\"noopener noreferrer\\">讯飞离线语音合成</a></li>\\n</ul>\\n<h2>起因</h2>\\n<blockquote>\\n<p>某日，看到一个营销号的视频说做视频日进斗金，大意是用软件识别文章小说，搭配一些图片转换成自己的视频。看完当时脑海里冒出一个念头，我也可以，于是有了这番尝试。</p>\\n</blockquote>","autoDesc":true}');export{f as comp,u as data};
