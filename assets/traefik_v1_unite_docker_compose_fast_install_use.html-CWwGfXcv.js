import{_ as i}from"./plugin-vue_export-helper-DlAUqK2U.js";import{c as a,e as n,o as e}from"./app-CzakNbIb.js";const l={};function t(k,s){return e(),a("div",null,s[0]||(s[0]=[n(`<h2 id="traefik-介绍" tabindex="-1"><a class="header-anchor" href="#traefik-介绍"><span>traefik 介绍</span></a></h2><blockquote><p><a href="http://docs.traefik.cn/" target="_blank" rel="noopener noreferrer">traefik</a> 是一个为了让部署微服务更加便捷而诞生的现代HTTP反向代理、负载均衡工具。 它支持多种后台 (Docker, Swarm, Kubernetes, Marathon, Mesos, Consul, Etcd, Zookeeper, BoltDB, Rest API, file…) 来自动化、动态的应用它的配置文件设置。</p></blockquote><h3 id="特性一览" tabindex="-1"><a class="header-anchor" href="#特性一览"><span>特性一览</span></a></h3><ul><li>它非常快</li><li>无需安装其他依赖，通过 Go 语言编写的单一可执行文件</li><li>支持 Rest API</li><li>多种后台支持：Docker, Swarm, Kubernetes, Marathon, Mesos, Consul, Etcd, 并且还会更多</li><li>后台监控, 可以监听后台变化进而自动化应用新的配置文件设置</li><li>配置文件热更新。无需重启进程</li><li>正常结束 http 连接</li><li>后端断路器</li><li>轮询，rebalancer 负载均衡</li><li>Rest Metrics</li><li>支持最小化 官方 docker 镜像</li><li>后台支持 SSL</li><li>前台支持 SSL（包括 SNI）</li><li>清爽的 AngularJS 前端页面</li><li>支持 Websocket</li><li>支持 HTTP/2</li><li>网络错误重试</li><li>支持 Let’s Encrypt (自动更新 HTTPS 证书)</li><li>高可用集群模式</li></ul><p>本文将分享 traefik 结合 docker-compose 的一点使用经验。</p><h2 id="docker-docker-ce-及-docker-compose-1-23-2-的快速安装" tabindex="-1"><a class="header-anchor" href="#docker-docker-ce-及-docker-compose-1-23-2-的快速安装"><span>docker(docker-ce) 及 docker-compose(1.23.2) 的快速安装</span></a></h2><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>sudo curl -fsSL https://get.docker.com | bash -s docker --mirror Aliyun</span></span>
<span class="line"><span>sudo curl -L https://github.com/docker/compose/releases/download/1.23.2/docker-compose-\`uname -s\`-\`uname -m\` -o /usr/local/bin/docker-compose</span></span>
<span class="line"><span>sudo chmod +x /usr/local/bin/docker-compose</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="docker-compose-安装-traefik-及使用" tabindex="-1"><a class="header-anchor" href="#docker-compose-安装-traefik-及使用"><span>docker-compose 安装 traefik 及使用</span></a></h2><p>用其搭配 docker-compose 部署网站，可轻松绑定域名，设置 https , 负载均衡，已在多个项目使用，文档可靠，强烈推荐！</p><p>以下为使用的基本操作</p><ol><li>创建 network，使 traefik 及网站处于同一网络</li><li>创建 traefik.toml(<a href="http://docs.traefik.cn/toml" target="_blank" rel="noopener noreferrer">官方文档</a>)</li><li>创建 acme.json (<code>touch acme.json &amp;&amp; chmod 600 ./acme.json</code>)</li><li>创建 docker-compose.yml</li></ol><h3 id="docker-compose-yml" tabindex="-1"><a class="header-anchor" href="#docker-compose-yml"><span>docker-compose.yml</span></a></h3><p>使用 <code>docker-compose up -d</code> 即可构建 traefik 服务, 根据 labels 标签通过监听其内部的 8090 端口，并绑定了域名 traefik.testdomain.com</p><p>docker-compose 可使用的 labes 配置见文档：http://docs.traefik.cn/toml#docker-backend traefik.toml 配置见文档：http://docs.traefik.cn/toml</p><p>使用之前需要先创建一个网络(<code>docker network create me_gateway</code>)，让 traefik 及所有网站都使用一个网络，这样就能够自动将域名绑定到对应的容器中</p><p>下面是一个 traefik 的 docker-compose.yml 配置</p><div class="language-yml line-numbers-mode" data-highlighter="shiki" data-ext="yml" data-title="yml" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">version</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;3&#39;</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">services</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">  me_traefik</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    restart</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">always</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    image</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">traefik:1.7.4</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    ports</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">      - </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;80:80&#39;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">      - </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;443:443&#39;</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    labels</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">      - </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;traefik.backend=me_traefik&#39;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">      - </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;traefik.frontend.rule=Host:traefik.testdomain.com&#39;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">      - </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;traefik.enable=true&#39;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">      - </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;traefik.passHostHeader=true&#39;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">      - </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;traefik.protocol=https&#39;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">      - </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;traefik.port=8090&#39;</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    volumes</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">      - </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">/var/run/docker.sock:/var/run/docker.sock</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">      - </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">./traefik.toml:/traefik.toml</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">      - </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">./acme.json:/acme.json</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    networks</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">      - </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">webgateway</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">networks</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">  webgateway</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    external</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">      name</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">me_gateway</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>volumes 说明</p><ul><li><code>/var/run/docker.sock</code>:主机 docker</li><li><code>./traefik.toml</code>:traefik 配置文件</li><li><code>./acme.json</code>:Let&#39;s Encrypt 配置，会根据 traefik.toml 生成，映射出来,后续重启数据将不会丢失，但是需要为其添加读写权限(chmod 600 acme.json),初始化时可以 <code>touch acme.json</code> 生成一个空文件</li></ul><p>下面是一个 traefik 的 traefik.toml 配置示例</p><div class="language-ini line-numbers-mode" data-highlighter="shiki" data-ext="ini" data-title="ini" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">################################################################</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># Global configuration</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">################################################################</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">debug</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> =</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;"> false</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">logLevel</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> =</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;ERROR&quot;</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">defaultEntryPoints</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> =</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;"> [</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;http&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;https&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">]</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">[entryPoints]</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">  [entryPoints.http]</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">  address</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> =</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;:80&quot;</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#    [entryPoints.http.redirect]</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#      entryPoint = &quot;https&quot;</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 启用https</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">  [entryPoints.https]</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">  address</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> =</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;:443&quot;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">    [entryPoints.https.tls]</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">  [entryPoints.webentry]</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">    address</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> =</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;:8090&quot;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">    [entryPoints.webentry.auth]</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">      [entryPoints.webentry.auth.basic]</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">         users</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> =</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;"> [</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;test:$apr1$H6uskkkW$IgXLP6ewTrSuBkTrqE8wj/&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">]</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">[api]</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">dashboard</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> =</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;"> true</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">entrypoint</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> =</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;webentry&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">[ping]</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">[docker]</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">endpoint</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> =</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;unix:///var/run/docker.sock&quot;</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">domain</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> =</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;testdomain.com&quot;</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">watch</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> =</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;"> true</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">exposedByDefault</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> =</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;"> false</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">usebindportip</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> =</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;"> true</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">swarmMode</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> =</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;"> false</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">network</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> =</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;me_gateway&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">[acme]</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 用于注册的邮箱地址</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">email</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> =</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;wsyimo@qq.com&quot;</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 证书存储使用的文件或键。</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">storage</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> =</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;acme.json&quot;</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 代理acme验证证书challenge/apply的入口点。</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 警告, 必需指向到一个443端口作为入口点</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">entryPoint</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> =</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;https&quot;</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 启用按需证书。如果这个主机名还没有证书，这将会在与一个主机名发起请求的第一个TLS握手中向Let&#39;s Encrypt请求一个证书。</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 警告，第一次在请求中获取主机证书会导致TLS握手会非常慢，这会引起Dos攻击。</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 警告，值得注意的是Let&#39;s Encrypt是有请求上限的：https://letsencrypt.org/docs/rate-limits</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">onDemand</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> =</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;"> false</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 启用根据前端Host规则来生成证书。这将会为每个具有Host规则的前端生成一个Let&#39;s Encrypt的证书。</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 举个例子，一个具有规则的Host:test1.traefik.cn,test2.traefik.cn 将会为主域名test1.traefik.cn与SAN(替代域名) test2.traefik.cn生成一个证书。</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">onHostRule</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> =</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;"> true</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">  [acme.httpChallenge]</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">  entryPoint</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;http&quot;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="traefik-自动申请-https-证书-let-s-encrypt" tabindex="-1"><a class="header-anchor" href="#traefik-自动申请-https-证书-let-s-encrypt"><span>traefik 自动申请 https 证书(Let’s Encrypt)</span></a></h3><p>文档地址：http://docs.traefik.cn/toml#acme-lets-encrypt-configuration</p><div class="language-ini line-numbers-mode" data-highlighter="shiki" data-ext="ini" data-title="ini" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">defaultEntryPoints</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> =</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;"> [</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;http&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;https&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">]</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">[entryPoints]</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">  [entryPoints.http]</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">  address</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> =</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;:80&quot;</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#    [entryPoints.http.redirect]</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#      entryPoint = &quot;https&quot;</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 启用https</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">  [entryPoints.https]</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">  address</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> =</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;:443&quot;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">    [entryPoints.https.tls]</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">  [entryPoints.webentry]</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">    address</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> =</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;:8090&quot;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="traefik-自定义入口并配置账户密码" tabindex="-1"><a class="header-anchor" href="#traefik-自定义入口并配置账户密码"><span>traefik 自定义入口并配置账户密码</span></a></h3><p>文档地址：http://docs.traefik.cn/toml#entrypoints-definition 但是，按照文档来，可能并不一定能够配置成功~,如果不成功就参考下面的配置吧,</p><div class="language-ini line-numbers-mode" data-highlighter="shiki" data-ext="ini" data-title="ini" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">defaultEntryPoints</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> =</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;"> [</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;http&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;https&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">]</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">[entryPoints]</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">  [entryPoints.http]</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">  address</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> =</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;:80&quot;</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#    [entryPoints.http.redirect]</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#      entryPoint = &quot;https&quot;</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 启用https</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">  [entryPoints.https]</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">  address</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> =</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;:443&quot;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">    [entryPoints.https.tls]</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">  [entryPoints.webentry]</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">    address</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> =</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;:8090&quot;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">    [entryPoints.webentry.auth]</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">      [entryPoints.webentry.auth.basic]</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">         users</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> =</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;"> [</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;test:$apr1$H6uskkkW$IgXLP6ewTrSuBkTrqE8wj/&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">]</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">[api]</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">dashboard</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> =</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;"> true</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">entrypoint</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> =</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;webentry&quot;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol><li>在 api 节点指定 entrypoint= 入口点</li><li>配置 entryPoints 节点</li></ol><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>[entryPoints]</span></span>
<span class="line"><span>    [entryPoints.入口点]</span></span>
<span class="line"><span>        address = &quot;:8090&quot;</span></span>
<span class="line"><span>        [entryPoints.webentry.auth]</span></span>
<span class="line"><span>        [entryPoints.webentry.auth.basic]</span></span>
<span class="line"><span>            users = [&quot;test:$apr1$H6uskkkW$IgXLP6ewTrSuBkTrqE8wj/&quot;]</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>上诉密码需要使用 htpasswd 生成，可在服务器生成，也可使用新鲜出炉的 metools 的<a href="https://metools.js.org/#/genpwd?type=htpasswd" target="_blank" rel="noopener noreferrer">htpasswd 密码生成</a> 在线生成了。(不支持traefik v2)</p><p>当 traefik 部署完成，后续网站绑定域名只需要在 docker-compose.yml 中指定 labels对应值即可自动绑定域名，申请 https 等操作了(指定到同一个网络)，关于更多使用场景及方法，还是需要去查看文档 ，<a href="https://github.com/moxycoding/moxy.config.docker/tree/master/provider.traefik" target="_blank" rel="noopener noreferrer">简单的可以参考我的配置</a>，clone 后通过 docker-compose.yml 就可快速在服务器构建你的项目了</p><h2 id="相关地址" tabindex="-1"><a class="header-anchor" href="#相关地址"><span>相关地址</span></a></h2><ul><li>完整使用示例：<a href="https://github.com/moxycoding/moxy.config.docker/tree/master/provider.traefik" target="_blank" rel="noopener noreferrer">参考时需注意域名端口的绑定</a></li><li>traefik 文档地址：http://docs.traefik.cn/</li><li>traefik 仓库地址：https://github.com/containous/traefik</li></ul>`,33)]))}const r=i(l,[["render",t],["__file","traefik_v1_unite_docker_compose_fast_install_use.html.vue"]]),d=JSON.parse('{"path":"/posts/docker/traefik_v1_unite_docker_compose_fast_install_use.html","title":"traefik v1 结合 docker-compose 的快速安装及使用","lang":"zh-CN","frontmatter":{"title":"traefik v1 结合 docker-compose 的快速安装及使用","date":"2019-02-20T16:58:00.000Z","category":["Docker"],"tag":["docker","docker-compose"],"description":"traefik 介绍 traefik 是一个为了让部署微服务更加便捷而诞生的现代HTTP反向代理、负载均衡工具。 它支持多种后台 (Docker, Swarm, Kubernetes, Marathon, Mesos, Consul, Etcd, Zookeeper, BoltDB, Rest API, file…) 来自动化、动态的应用它的配置文件设...","head":[["meta",{"property":"og:url","content":"https://www.yimo.link/posts/docker/traefik_v1_unite_docker_compose_fast_install_use.html"}],["meta",{"property":"og:site_name","content":"易墨网"}],["meta",{"property":"og:title","content":"traefik v1 结合 docker-compose 的快速安装及使用"}],["meta",{"property":"og:description","content":"traefik 介绍 traefik 是一个为了让部署微服务更加便捷而诞生的现代HTTP反向代理、负载均衡工具。 它支持多种后台 (Docker, Swarm, Kubernetes, Marathon, Mesos, Consul, Etcd, Zookeeper, BoltDB, Rest API, file…) 来自动化、动态的应用它的配置文件设..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2024-10-28T11:15:42.000Z"}],["meta",{"property":"article:tag","content":"docker"}],["meta",{"property":"article:tag","content":"docker-compose"}],["meta",{"property":"article:published_time","content":"2019-02-20T16:58:00.000Z"}],["meta",{"property":"article:modified_time","content":"2024-10-28T11:15:42.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"traefik v1 结合 docker-compose 的快速安装及使用\\",\\"image\\":[\\"\\"],\\"datePublished\\":\\"2019-02-20T16:58:00.000Z\\",\\"dateModified\\":\\"2024-10-28T11:15:42.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"易墨\\",\\"url\\":\\"https://www.yimo.link\\"}]}"]]},"headers":[{"level":2,"title":"traefik 介绍","slug":"traefik-介绍","link":"#traefik-介绍","children":[{"level":3,"title":"特性一览","slug":"特性一览","link":"#特性一览","children":[]}]},{"level":2,"title":"docker(docker-ce) 及 docker-compose(1.23.2) 的快速安装","slug":"docker-docker-ce-及-docker-compose-1-23-2-的快速安装","link":"#docker-docker-ce-及-docker-compose-1-23-2-的快速安装","children":[]},{"level":2,"title":"docker-compose 安装 traefik 及使用","slug":"docker-compose-安装-traefik-及使用","link":"#docker-compose-安装-traefik-及使用","children":[{"level":3,"title":"docker-compose.yml","slug":"docker-compose-yml","link":"#docker-compose-yml","children":[]},{"level":3,"title":"traefik 自动申请 https 证书(Let’s Encrypt)","slug":"traefik-自动申请-https-证书-let-s-encrypt","link":"#traefik-自动申请-https-证书-let-s-encrypt","children":[]},{"level":3,"title":"traefik 自定义入口并配置账户密码","slug":"traefik-自定义入口并配置账户密码","link":"#traefik-自定义入口并配置账户密码","children":[]}]},{"level":2,"title":"相关地址","slug":"相关地址","link":"#相关地址","children":[]}],"git":{"createdTime":1730114142000,"updatedTime":1730114142000,"contributors":[{"name":"yimo","email":"yimo@wikiglobal.com","commits":1}]},"readingTime":{"minutes":4.42,"words":1327},"filePathRelative":"posts/docker/traefik_v1_unite_docker_compose_fast_install_use.md","localizedDate":"2019年2月20日","excerpt":"<h2>traefik 介绍</h2>\\n<blockquote>\\n<p><a href=\\"http://docs.traefik.cn/\\" target=\\"_blank\\" rel=\\"noopener noreferrer\\">traefik</a> 是一个为了让部署微服务更加便捷而诞生的现代HTTP反向代理、负载均衡工具。 它支持多种后台 (Docker, Swarm, Kubernetes, Marathon, Mesos, Consul, Etcd, Zookeeper, BoltDB, Rest API, file…) 来自动化、动态的应用它的配置文件设置。</p>\\n</blockquote>","autoDesc":true}');export{r as comp,d as data};
