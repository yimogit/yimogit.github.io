import{_ as s}from"./plugin-vue_export-helper-DlAUqK2U.js";import{c as e,e as a,o as i}from"./app-s030diJy.js";const l="data:image/png;base64,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",p="/assets/662652-20190928201255259-65291675-Bwqqu4Ov.png",t="/assets/662652-20190928193613385-1246781708-UW0I2naB.png",r="data:image/png;base64,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",d={};function c(o,n){return i(),e("div",null,n[0]||(n[0]=[a(`<h2 id="先说一个问题" tabindex="-1"><a class="header-anchor" href="#先说一个问题"><span>先说一个问题</span></a></h2><p>首先记录一个问题，今天在用 Jenkins 构建项目的时候突然出现包源的错误：</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span></span></span>
<span class="line"><span>/usr/share/dotnet/sdk/2.2.104/NuGet.targets(114,5): error : Unable to load the service index for source https://api.nuget.org/v3/index.json. [/....csproj]</span></span>
<span class="line"><span></span></span>
<span class="line"><span>/usr/share/dotnet/sdk/2.2.104/NuGet.targets(114,5): error :   The HTTP request to &#39;GET https://api.nuget.org/v3/index.json&#39; has timed out after 100000ms. [/....csproj]</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>nuget的包源无法访问(无法ping通)，而我在一台服务器上访问<code>https://api.nuget.org/v3/index.json</code>时则会自动重定向到<code>https://nuget.cdn.azure.cn/v3/index.json</code>。</p><p>但是打包机器执行<code>dotnet restore</code>却还是无法还原成功，即使指定包源后即<code>dotnet restore -s https://nuget.cdn.azure.cn/v3/index.json</code> 能还原一部分包，部分包依旧无法还原</p><p>最后测试发现，包源只是部分地区无法访问，可以尝试切换源/使用Nuget.Config文件试试，当然最快的还是通过科学的方式访问~。</p><figure><img src="`+l+'" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>若本地 VS 的包管理器也无法正常使用，切换源(https://nuget.cdn.azure.cn/v3/index.json)即可</p><figure><img src="'+p+`" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><h2 id="再说另外一个问题" tabindex="-1"><a class="header-anchor" href="#再说另外一个问题"><span>再说另外一个问题</span></a></h2><p>然后这篇文章其实是另外的一个问题，之前我构建了一个基础镜像包，基于<code>FROM microsoft/dotnet:2.2-aspnetcore-runtime</code>构建，而我构建时使用的sdk镜像是<code>FROM microsoft/dotnet:2.2-sdk</code></p><p>9.23号(.net core 3.0发布)之前还能够正常构建，今天在解决了上面包源问题后，镜像构建成功并发布到服务器，却发现镜像无法启动起来。</p><p>报错信息如下</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span></span></span>
<span class="line"><span>The specified framework &#39;Microsoft.NETCore.App&#39;, version &#39;2.2.2&#39; was not found.</span></span>
<span class="line"><span></span></span>
<span class="line"><span>  - Check application dependencies and target a framework version installed at:</span></span>
<span class="line"><span></span></span>
<span class="line"><span>      /usr/share/dotnet/</span></span>
<span class="line"><span></span></span>
<span class="line"><span>  - Installing .NET Core prerequisites might help resolve this problem:</span></span>
<span class="line"><span></span></span>
<span class="line"><span>      http://go.microsoft.com/fwlink/?LinkID=798306&amp;clcid=0x409</span></span>
<span class="line"><span></span></span>
<span class="line"><span>  - The .NET Core framework and SDK can be installed from:</span></span>
<span class="line"><span></span></span>
<span class="line"><span>      https://aka.ms/dotnet-download</span></span>
<span class="line"><span></span></span>
<span class="line"><span>  - The following versions are installed:</span></span>
<span class="line"><span></span></span>
<span class="line"><span>      2.2.0 at [/usr/share/dotnet/shared/Microsoft.NETCore.App]</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>既然说是版本问题，那就尝试着将基础进行修改为<code>FROM microsoft/dotnet:2.2.2-aspnetcore-runtime</code>,果然，重新构建后能够好好的运行起来了。</p><p>那么我是如何构建的基础镜像的，只需下面 3 个文件就搞定了。</p><h2 id="阿里云镜像源" tabindex="-1"><a class="header-anchor" href="#阿里云镜像源"><span>阿里云镜像源</span></a></h2><p>阿里云的软件包源，可用于一些基础镜像中没有的软件安装，写入到 sources.list 供后面使用</p><ul><li>文件：sources.list</li></ul><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span></span></span>
<span class="line"><span>deb http://mirrors.aliyun.com/debian jessie main contrib non-free</span></span>
<span class="line"><span></span></span>
<span class="line"><span>deb-src http://mirrors.aliyun.com/debian jessie main contrib non-free</span></span>
<span class="line"><span></span></span>
<span class="line"><span>deb http://mirrors.aliyun.com/debian jessie-updates main contrib non-free</span></span>
<span class="line"><span></span></span>
<span class="line"><span>deb-src http://mirrors.aliyun.com/debian jessie-updates main contrib non-free</span></span>
<span class="line"><span></span></span>
<span class="line"><span>deb http://mirrors.aliyun.com/debian-security jessie/updates main contrib non-free</span></span>
<span class="line"><span></span></span>
<span class="line"><span>deb-src http://mirrors.aliyun.com/debian-security jessie/updates main contrib non-free</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="一个包含图像库的-dockerfile" tabindex="-1"><a class="header-anchor" href="#一个包含图像库的-dockerfile"><span>一个包含图像库的 Dockerfile</span></a></h2><p>基于<code>dotnet:2.2.2 aspnetcore-runtime</code>，并在其中安装 <code>libgdiplus</code>，设置时区，具体的可以根据自己的项目需要去构建</p><p>文件：Dockerfile</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span></span></span>
<span class="line"><span>FROM microsoft/dotnet:2.2.2-aspnetcore-runtime</span></span>
<span class="line"><span></span></span>
<span class="line"><span>WORKDIR /app</span></span>
<span class="line"><span></span></span>
<span class="line"><span>COPY sources.list /app/sources.list</span></span>
<span class="line"><span></span></span>
<span class="line"><span>RUN rm -f /etc/apt/sources.list &amp;&amp; mv sources.list /etc/apt/ &amp;&amp; apt-get update -y &amp;&amp; apt-get install -y libgdiplus &amp;&amp; apt-get clean &amp;&amp; ln -s /usr/lib/libgdiplus.so /usr/lib/gdiplus.dll</span></span>
<span class="line"><span></span></span>
<span class="line"><span></span></span>
<span class="line"><span></span></span>
<span class="line"><span># 时区设置</span></span>
<span class="line"><span></span></span>
<span class="line"><span>ENV TZ=Asia/Shanghai</span></span>
<span class="line"><span></span></span>
<span class="line"><span>RUN ln -snf /usr/share/zoneinfo/$TZ /etc/localtime &amp;&amp; echo $TZ &gt; /etc/timezone</span></span>
<span class="line"><span></span></span>
<span class="line"><span></span></span>
<span class="line"><span></span></span>
<span class="line"><span># ENTRYPOINT [&quot;./xxxxx.dll&quot;]</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="使用脚本推送镜像到阿里云的容器镜像仓库" tabindex="-1"><a class="header-anchor" href="#使用脚本推送镜像到阿里云的容器镜像仓库"><span>使用脚本推送镜像到阿里云的容器镜像仓库</span></a></h2><p>要推送镜像到阿里云，需要先去阿里云开通并创建命名空间</p><p>需要先登录云端镜像仓库 ，登录阿里云如下</p><figure><img src="`+t+`" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>文件名：build.sh (Linux添加执行权限 <code>chmod +x ./build.sh</code>)</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span></span></span>
<span class="line"><span>export ALIYUN_DOCKER_CLOUD_URL=registry.cn-hangzhou.aliyuncs.com</span></span>
<span class="line"><span></span></span>
<span class="line"><span>export DOCKER_IMAGE_NAME=yimocoding/dotnet2.2.2-base</span></span>
<span class="line"><span></span></span>
<span class="line"><span>export BUILD_NUMBER=latest</span></span>
<span class="line"><span></span></span>
<span class="line"><span></span></span>
<span class="line"><span></span></span>
<span class="line"><span>docker build -t $DOCKER_IMAGE_NAME -f ./Dockerfile .</span></span>
<span class="line"><span></span></span>
<span class="line"><span>docker tag $DOCKER_IMAGE_NAME $ALIYUN_DOCKER_CLOUD_URL/$DOCKER_IMAGE_NAME:$BUILD_NUMBER</span></span>
<span class="line"><span></span></span>
<span class="line"><span>echo 推送镜像到云端</span></span>
<span class="line"><span></span></span>
<span class="line"><span>docker push $ALIYUN_DOCKER_CLOUD_URL/$DOCKER_IMAGE_NAME:$BUILD_NUMBER</span></span>
<span class="line"><span></span></span>
<span class="line"><span></span></span>
<span class="line"><span></span></span>
<span class="line"><span>echo &#39;删除本地镜像&#39;</span></span>
<span class="line"><span></span></span>
<span class="line"><span>docker rmi $DOCKER_IMAGE_NAME</span></span>
<span class="line"><span></span></span>
<span class="line"><span>docker rmi $ALIYUN_DOCKER_CLOUD_URL/$DOCKER_IMAGE_NAME:$BUILD_NUMBER</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="三个文件的目录结构" tabindex="-1"><a class="header-anchor" href="#三个文件的目录结构"><span>三个文件的目录结构</span></a></h2><figure><img src="`+r+'" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>文件创建完成后,执行 <code>build.sh</code> 即可构建镜像并推送到阿里云的镜像仓库，若想提交到其他云仓库，修改脚本中的变量即可</p><p>示例文件：https://github.com/yimogit/MeDocker/tree/dotnet</p><p>真是，人在家中坐，锅从天落，而为了更好的接锅，记录一二，免得到时候望码兴叹。</p>',35)]))}const m=s(d,[["render",c],["__file","docker_dotnet_nuget_error_docker_custom_build.html.vue"]]),h=JSON.parse(`{"path":"/posts/dotnetcore/docker_dotnet_nuget_error_docker_custom_build.html","title":"自定义构建基于.net core 的基础镜像","lang":"zh-CN","frontmatter":{"title":"自定义构建基于.net core 的基础镜像","date":"2019-09-28T21:03:00.000Z","category":["DotNetCore"],"tag":[".net core","docker"],"description":"先说一个问题 首先记录一个问题，今天在用 Jenkins 构建项目的时候突然出现包源的错误： nuget的包源无法访问(无法ping通)，而我在一台服务器上访问https://api.nuget.org/v3/index.json时则会自动重定向到https://nuget.cdn.azure.cn/v3/index.json。 但是打包机器执行dot...","head":[["meta",{"property":"og:url","content":"https://www.yimo.link/posts/dotnetcore/docker_dotnet_nuget_error_docker_custom_build.html"}],["meta",{"property":"og:site_name","content":"易墨网"}],["meta",{"property":"og:title","content":"自定义构建基于.net core 的基础镜像"}],["meta",{"property":"og:description","content":"先说一个问题 首先记录一个问题，今天在用 Jenkins 构建项目的时候突然出现包源的错误： nuget的包源无法访问(无法ping通)，而我在一台服务器上访问https://api.nuget.org/v3/index.json时则会自动重定向到https://nuget.cdn.azure.cn/v3/index.json。 但是打包机器执行dot..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2024-10-28T11:15:42.000Z"}],["meta",{"property":"article:tag","content":".net core"}],["meta",{"property":"article:tag","content":"docker"}],["meta",{"property":"article:published_time","content":"2019-09-28T21:03:00.000Z"}],["meta",{"property":"article:modified_time","content":"2024-10-28T11:15:42.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"自定义构建基于.net core 的基础镜像\\",\\"image\\":[\\"\\"],\\"datePublished\\":\\"2019-09-28T21:03:00.000Z\\",\\"dateModified\\":\\"2024-10-28T11:15:42.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"易墨\\",\\"url\\":\\"https://www.yimo.link\\"}]}"]]},"headers":[{"level":2,"title":"先说一个问题","slug":"先说一个问题","link":"#先说一个问题","children":[]},{"level":2,"title":"再说另外一个问题","slug":"再说另外一个问题","link":"#再说另外一个问题","children":[]},{"level":2,"title":"阿里云镜像源","slug":"阿里云镜像源","link":"#阿里云镜像源","children":[]},{"level":2,"title":"一个包含图像库的 Dockerfile","slug":"一个包含图像库的-dockerfile","link":"#一个包含图像库的-dockerfile","children":[]},{"level":2,"title":"使用脚本推送镜像到阿里云的容器镜像仓库","slug":"使用脚本推送镜像到阿里云的容器镜像仓库","link":"#使用脚本推送镜像到阿里云的容器镜像仓库","children":[]},{"level":2,"title":"三个文件的目录结构","slug":"三个文件的目录结构","link":"#三个文件的目录结构","children":[]}],"git":{"createdTime":1730114142000,"updatedTime":1730114142000,"contributors":[{"name":"yimo","email":"yimo@wikiglobal.com","commits":1}]},"readingTime":{"minutes":3.09,"words":927},"filePathRelative":"posts/dotnetcore/docker_dotnet_nuget_error_docker_custom_build.md","localizedDate":"2019年9月28日","excerpt":"<h2>先说一个问题</h2>\\n<p>首先记录一个问题，今天在用 Jenkins 构建项目的时候突然出现包源的错误：</p>\\n<div class=\\"language- line-numbers-mode\\" data-highlighter=\\"shiki\\" data-ext=\\"\\" data-title=\\"\\" style=\\"--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34\\"><pre class=\\"shiki shiki-themes one-light one-dark-pro vp-code\\"><code><span class=\\"line\\"><span></span></span>\\n<span class=\\"line\\"><span>/usr/share/dotnet/sdk/2.2.104/NuGet.targets(114,5): error : Unable to load the service index for source https://api.nuget.org/v3/index.json. [/....csproj]</span></span>\\n<span class=\\"line\\"><span></span></span>\\n<span class=\\"line\\"><span>/usr/share/dotnet/sdk/2.2.104/NuGet.targets(114,5): error :   The HTTP request to 'GET https://api.nuget.org/v3/index.json' has timed out after 100000ms. [/....csproj]</span></span></code></pre>\\n<div class=\\"line-numbers\\" aria-hidden=\\"true\\" style=\\"counter-reset:line-number 0\\"><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div></div></div>","autoDesc":true}`);export{m as comp,h as data};
