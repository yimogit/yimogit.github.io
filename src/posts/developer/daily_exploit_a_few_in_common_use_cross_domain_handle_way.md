---
title: 日常开发中的几个常用跨域处理方式
date: 2018-02-06 19:01:00
category:
  - Developer
tag:
  - web开发
  - .net core
---

## 设置express代理请求

> 在基于`vue-cli`的项目中，在开发环境配置(config/dev.env.js)中设置代理，能够将所有`/apidomain`开头的请求都通过`npm run dev`启动的`express`服务器重定向到目标接口        

> 官方文档：https://vuejs-templates.github.io/webpack/proxy.html    



``` js

    proxyTable: {

      '/apidomain':{

        target:'http://localhost:prot',//或ip或域名。

        changeOrigin:true,

        pathRewrite: {

          '^/apidomain': ''

        }

      }

    },



```

若要通过IP在局域网访问h5，启动开发服务器的时候添加`host`参数即可

即package.json的dev命令配置如下 

` "dev": "webpack-dev-server --inline --progress --config build/webpack.dev.conf.js --host 0.0.0.0",`



## 关闭chrome安全策略实现跨域            

> windows中新建一个bat文件粘贴下面的命令即可以此模式打开         

> 更多可参考：https://www.cnblogs.com/zhongxia/p/5416024.html     



```

cd "C:\Program Files (x86)\Google\Chrome\Application" 

chrome.exe --disable-web-security --user-data-dir=c:/CorsUserData

```

## asp.net core 服务端的CORS跨域设置        

> 官方文档：https://docs.microsoft.com/zh-cn/aspnet/core/security/cors           

> 必读文章：[跨域资源共享 CORS 详解-阮一峰](http://www.ruanyifeng.com/blog/2016/04/cors.html)       

> 在实际设置中，因为在h5端添加header参数产生了`预检(OPTIONS)请求`，看了上述文章后将通用参数修改到了query参数中        



### 1. 添加cors服务         

``` csharp

public void ConfigureServices(IServiceCollection services)

{

    //若只有部分接口则定义一个或多个命名的 CORS 策略，并在运行时按名称然后选择的策略,通过特性标记去设置跨域 详情见文档

    services.AddCors();

}

``` 



### 2. 启用中间件        

``` csharp

//读取配置文件中设置的允许跨域的域名 CorsOrigins为一个数组  设置["*"]则会允许所有

var origins = Configuration.GetSection("CorsOrigins").GetChildren().Select(s => s.Value).ToArray();

app.UseCors(e =>

{

    e.WithOrigins(origins).AllowAnyHeader().AllowAnyMethod().AllowCredentials();

});

```     

``` csharp

//Startup文件中Configuration对象的获取

public IConfiguration Configuration { get; }

public Startup()

{

    var builder = new ConfigurationBuilder()//...AddJsonFile($"appsettings.json");

    Configuration = builder.Build();

}

```



## JSONP        

> JSONP只支持GET请求，CORS支持所有类型的HTTP请求。JSONP的优势在于支持老式浏览器，以及可以向不支持CORS的网站请求数据。

> 必读文章：[跨域资源共享 CORS 详解-阮一峰](http://www.ruanyifeng.com/blog/2016/04/cors.html)
