<!doctype html>
<html lang="zh-CN" data-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-rc.18" />
    <meta name="theme" content="VuePress Theme Hope 2.0.0-rc.59" />
    <style>
      :root {
        --vp-c-bg: #fff;
      }

      [data-theme="dark"] {
        --vp-c-bg: #1b1b1f;
      }

      html,
      body {
        background: var(--vp-c-bg);
      }
    </style>
    <script>
      const userMode = localStorage.getItem("vuepress-theme-hope-scheme");
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches;

      if (userMode === "dark" || (userMode !== "light" && systemDarkMode)) {
        document.documentElement.setAttribute("data-theme", "dark");
      }
    </script>
    <meta property="og:url" content="https://www.yimo.link/posts/devops/devops_k8s_install_use.html"><meta property="og:site_name" content="易墨网"><meta property="og:title" content="一篇可供参考的 K8S 落地实践经验"><meta property="og:description" content="前言 k8s 即 Kubernetes，是一个开源的容器编排引擎，用来对容器化应用进行自动化部署、 扩缩和管理 本篇文章将分享 k8s v1.18.8 的安装，以及其面板，监控，部署服务，使用Ingress-Ningx进行负载均衡的实践 因为公司用的这个老版本，并且后面要负责搭建，担心无法复刻，趁此周末，实践一二，确认可行，遂与君分享。 虚拟机准备 宿..."><meta property="og:type" content="article"><meta property="og:locale" content="zh-CN"><meta property="og:updated_time" content="2024-10-28T11:15:42.000Z"><meta property="article:tag" content="devops"><meta property="article:tag" content="k8s"><meta property="article:published_time" content="2023-12-26T08:38:00.000Z"><meta property="article:modified_time" content="2024-10-28T11:15:42.000Z"><script type="application/ld+json">{"@context":"https://schema.org","@type":"Article","headline":"一篇可供参考的 K8S 落地实践经验","image":[""],"datePublished":"2023-12-26T08:38:00.000Z","dateModified":"2024-10-28T11:15:42.000Z","author":[{"@type":"Person","name":"易墨","url":"https://www.yimo.link"}]}</script><link rel="icon" href="/favicon.ico"><title>一篇可供参考的 K8S 落地实践经验 | 易墨网</title><meta name="description" content="前言 k8s 即 Kubernetes，是一个开源的容器编排引擎，用来对容器化应用进行自动化部署、 扩缩和管理 本篇文章将分享 k8s v1.18.8 的安装，以及其面板，监控，部署服务，使用Ingress-Ningx进行负载均衡的实践 因为公司用的这个老版本，并且后面要负责搭建，担心无法复刻，趁此周末，实践一二，确认可行，遂与君分享。 虚拟机准备 宿...">
    <link rel="preload" href="/assets/style-D1743K4H.css" as="style"><link rel="stylesheet" href="/assets/style-D1743K4H.css">
    <link rel="modulepreload" href="/assets/app-BJhRIsgW.js"><link rel="modulepreload" href="/assets/devops_k8s_install_use.html-biAkdNjG.js"><link rel="modulepreload" href="/assets/plugin-vue_export-helper-DlAUqK2U.js">
    <link rel="prefetch" href="/assets/index.html-1JRB42Xd.js" as="script"><link rel="prefetch" href="/assets/intro.html-C-ZDq8Bw.js" as="script"><link rel="prefetch" href="/assets/index.html-CdzV1JGJ.js" as="script"><link rel="prefetch" href="/assets/disable.html-nLB_PZyD.js" as="script"><link rel="prefetch" href="/assets/encrypt.html-_Nlv5EGU.js" as="script"><link rel="prefetch" href="/assets/layout.html-nQl9PHjX.js" as="script"><link rel="prefetch" href="/assets/markdown.html-CVuES-N7.js" as="script"><link rel="prefetch" href="/assets/page.html-CuHIR8-6.js" as="script"><link rel="prefetch" href="/assets/index.html-CDJGW6cP.js" as="script"><link rel="prefetch" href="/assets/index.html-sY3hU3ya.js" as="script"><link rel="prefetch" href="/assets/zhontai_admin_core_book_01.html-CoZGXrL1.js" as="script"><link rel="prefetch" href="/assets/zhontai_admin_core_book_02.html-CZUYODHk.js" as="script"><link rel="prefetch" href="/assets/zhontai_admin_core_book_03.html-Dt8ekGa-.js" as="script"><link rel="prefetch" href="/assets/zhontai_admin_core_book_04.html-CfslmWYW.js" as="script"><link rel="prefetch" href="/assets/zhontai_admin_core_module_dev_gencode.html-BRCPANGD.js" as="script"><link rel="prefetch" href="/assets/zhontai_admin_core_module_dev_use_toproject.html-P5kQEYOT.js" as="script"><link rel="prefetch" href="/assets/index.html-Co27LqhE.js" as="script"><link rel="prefetch" href="/assets/c__operation_operator_operator_easy_use_test.html-BNvtQQS9.js" as="script"><link rel="prefetch" href="/assets/csharp_eval.html-CK9CNhjr.js" as="script"><link rel="prefetch" href="/assets/daily_exploit_a_few_in_common_use_cross_domain_handle_way.html-BbgONiqj.js" as="script"><link rel="prefetch" href="/assets/db_data_derive_tool_share.html-BY9Np3h-.js" as="script"><link rel="prefetch" href="/assets/git_common_commands.html-CeiiO0oa.js" as="script"><link rel="prefetch" href="/assets/k8s_certificate_expire_handle.html-C-6ztJ3R.js" as="script"><link rel="prefetch" href="/assets/linux_study_record01.html-CKnoofvt.js" as="script"><link rel="prefetch" href="/assets/message_queue_study_records.html-Du6BVgoo.js" as="script"><link rel="prefetch" href="/assets/mqdemo_msmq.html-BraXFvsg.js" as="script"><link rel="prefetch" href="/assets/nodejs_in_common_use_code_fragment.html-ejwZnOFl.js" as="script"><link rel="prefetch" href="/assets/nopiexcelimport.html-C7YUQnO8.js" as="script"><link rel="prefetch" href="/assets/part_sms_price_preview.html-Cebne_Ma.js" as="script"><link rel="prefetch" href="/assets/pass_script_download_go_in_common_use_be_related_to.html-C6H-RNjZ.js" as="script"><link rel="prefetch" href="/assets/plug_in_programming_realize_a_portion_chestnut_roasted_chestnuts.html-e4q-15o3.js" as="script"><link rel="prefetch" href="/assets/python_build_android_apk.html-C8Tv66wp.js" as="script"><link rel="prefetch" href="/assets/react_initstep.html-B7CfMbAd.js" as="script"><link rel="prefetch" href="/assets/scale_one_another_convert_study_records.html-D8QymIPr.js" as="script"><link rel="prefetch" href="/assets/service_item_service_item_git_stash_auto_automate_script.html-Cvh_Xp2w.js" as="script"><link rel="prefetch" href="/assets/software_recommend_spacesniffer.html-CjyrVxwd.js" as="script"><link rel="prefetch" href="/assets/travis_ci_operation_puppeteer.html-D8T9D1df.js" as="script"><link rel="prefetch" href="/assets/use_handle_batch_processing_script_cheerful_clear_cache.html-B8uLt151.js" as="script"><link rel="prefetch" href="/assets/use_tts_ffmpeg_auto_generate_video.html-BKG61zAw.js" as="script"><link rel="prefetch" href="/assets/wechat_native_payment_scan_the_code_payment_commercial_owner_disposition.html-woRLVyi1.js" as="script"><link rel="prefetch" href="/assets/windows_go_exploit_environment_disposition_professional_disposition.html-BvYTJIwD.js" as="script"><link rel="prefetch" href="/assets/winform_copy_document_appoint_catalogue.html-lC5zCCVt.js" as="script"><link rel="prefetch" href="/assets/winform_manufacture_tool_craftsmanship.html-BynD2VN6.js" as="script"><link rel="prefetch" href="/assets/with_regard_to_use_uniapp_android_offline_pack_look_out_item_matters_needing_attention.html-Ba25uWfk.js" as="script"><link rel="prefetch" href="/assets/index.html-DDf76h_e.js" as="script"><link rel="prefetch" href="/assets/devops_apollo_install.html-CopANvGj.js" as="script"><link rel="prefetch" href="/assets/devops_dns_dnserver_install_use.html-DLVlK31s.js" as="script"><link rel="prefetch" href="/assets/devops_docker24_composev2_install.html-BicBWG6u.js" as="script"><link rel="prefetch" href="/assets/devops_docker_clickhouse_install.html-bLgNnE4z.js" as="script"><link rel="prefetch" href="/assets/devops_docker_elk_install_nginx_config.html-BzLfVXHF.js" as="script"><link rel="prefetch" href="/assets/devops_docker_mysql_mongo.html-CekZZ9-d.js" as="script"><link rel="prefetch" href="/assets/devops_docker_redis_cluster_install.html-B2b8JTN2.js" as="script"><link rel="prefetch" href="/assets/devops_docker_to_nexus_deploy_k8s_use.html-9HKxr-BP.js" as="script"><link rel="prefetch" href="/assets/devops_hyperv_centos_install.html-5d2R_2Xq.js" as="script"><link rel="prefetch" href="/assets/devops_jumpserver_install_use.html-BN6kvTQ6.js" as="script"><link rel="prefetch" href="/assets/devops_nexus3_nuget_docker_install_use.html-CvBrhZWr.js" as="script"><link rel="prefetch" href="/assets/devops_prometheus_grafana_install_use_db_site_monitor.html-CCsCzVjq.js" as="script"><link rel="prefetch" href="/assets/index.html-v3hFNIZZ.js" as="script"><link rel="prefetch" href="/assets/docker_build_node_vue_01.html-C0meNhqC.js" as="script"><link rel="prefetch" href="/assets/docker_compose_yml_share.html-DR7pdkVB.js" as="script"><link rel="prefetch" href="/assets/docker_docker_compose_fast_install_easy_use.html-D01O70jr.js" as="script"><link rel="prefetch" href="/assets/docker_jenkins_use.html-9fTiUatd.js" as="script"><link rel="prefetch" href="/assets/docker_publish_netcore_website_scattered_records.html-BH2_t28E.js" as="script"><link rel="prefetch" href="/assets/jenkins_shell_script_operation_docker_limits_of_authority_report_an_error_work_out.html-Bu_tCemA.js" as="script"><link rel="prefetch" href="/assets/traefik_v1_unite_docker_compose_fast_install_use.html-CIIOwgNa.js" as="script"><link rel="prefetch" href="/assets/index.html-BNLxq7Xw.js" as="script"><link rel="prefetch" href="/assets/asp_net_core2.1_append_middle_middleware_extend_swashbuckle_aspnetcore3.0_support_easy_document_interview_limits_of_authority_controls.html-tJiNy6FP.js" as="script"><link rel="prefetch" href="/assets/asp_net_core_backstage_system_log_in_fast_construct.html-MFMC0JJa.js" as="script"><link rel="prefetch" href="/assets/asp_net_core_encapsulation_layui_module_give_an_example_share.html-C-orJs4I.js" as="script"><link rel="prefetch" href="/assets/asp_net_core_limits_of_authority_module_fast_construct.html-BQdQYtHi.js" as="script"><link rel="prefetch" href="/assets/asp_net_core_merge_compress_assets_document_trigger_study_a_trip_to.html-bOqglHC_.js" as="script"><link rel="prefetch" href="/assets/asp_net_core_use_mysql_records.html-Btw1vw1k.js" as="script"><link rel="prefetch" href="/assets/asp_net_core_use_swashbuckle_aspnetcore_swagger_generate_port_document.html-Dx31lNfM.js" as="script"><link rel="prefetch" href="/assets/docker_dotnet_nuget_error_docker_custom_build.html-CW7wlQd2.js" as="script"><link rel="prefetch" href="/assets/docker_publish_netcore_website_scattered_records.html-CB2Yt1uU.js" as="script"><link rel="prefetch" href="/assets/dotnet_additional_process_debugging_bug.html-apPF2aJl.js" as="script"><link rel="prefetch" href="/assets/dotnet_use_selenium_carry_out_auto_automate_quest.html-Btle0RMT.js" as="script"><link rel="prefetch" href="/assets/dotnet_warp_nssm_deploy_net_core_item_windows_service.html-CIX8lXjE.js" as="script"><link rel="prefetch" href="/assets/in_common_use_cmd_code_fragment_net_core_pack_script_share.html-Pjz_vWGp.js" as="script"><link rel="prefetch" href="/assets/mvc_website_transfer_net_core_records.html-BKlH6FJu.js" as="script"><link rel="prefetch" href="/assets/net_core2.1_use_dynamic_type_report_an_error.html-D3q9ACMN.js" as="script"><link rel="prefetch" href="/assets/net_core_selenium_github_travis_ci_sitehistory.html-BDR6YP1f.js" as="script"><link rel="prefetch" href="/assets/netcore8_swagger_group_namespace_show.html-M70qD97j.js" as="script"><link rel="prefetch" href="/assets/netcore_01.html-LzYOryOQ.js" as="script"><link rel="prefetch" href="/assets/swashbuckle_aspnetcore3.0_twice_encapsulation_use.html-DJy0Q3op.js" as="script"><link rel="prefetch" href="/assets/ubuntu_view_unload_software_unload_net_core_sdk_method.html-DmlYYdEi.js" as="script"><link rel="prefetch" href="/assets/index.html-DreUvY-G.js" as="script"><link rel="prefetch" href="/assets/national_day_holiday_note_complete_perfect.html-n32T56h-.js" as="script"><link rel="prefetch" href="/assets/single_routine_2023_sum_up_look_for.html-Ch9J3MpP.js" as="script"><link rel="prefetch" href="/assets/index.html-CarVLPwZ.js" as="script"><link rel="prefetch" href="/assets/customize_definition_custom_roll_scroll_bar_pattern_layui_v1.html-DpzlcA7t.js" as="script"><link rel="prefetch" href="/assets/devops_nginx_install_use.html-Dy-Ghx3z.js" as="script"><link rel="prefetch" href="/assets/front_and_rear_useful_come_in_handy_nginx_daily_use_exp_replenishment.html-Dqz-EObe.js" as="script"><link rel="prefetch" href="/assets/layui_use_autocomplete_js.html-Jdpq9ehv.js" as="script"><link rel="prefetch" href="/assets/metools_remark.html-BQ6DT-3J.js" as="script"><link rel="prefetch" href="/assets/share_vue_item_with_regard_to_api_request_some_realize_item_frame.html-Ce5iAnc6.js" as="script"><link rel="prefetch" href="/assets/taghelper_layui_encapsulation_module_radio_single_choice_checkbox_radio_box.html-CQRbuFeg.js" as="script"><link rel="prefetch" href="/assets/vue_item_append_pwa_work_out_publish_refresh_report_an_error_problem.html-FeEnhbvz.js" as="script"><link rel="prefetch" href="/assets/vue_item_practice_append_axios_encapsulation_api_request.html-BVQSf4-G.js" as="script"><link rel="prefetch" href="/assets/vue_item_practice_append_express_mockjs_proceed_data_simulate.html-D5dB1DYl.js" as="script"><link rel="prefetch" href="/assets/vue_item_practice_front_and_rear_separate_with_regard_to_limits_of_authority_train_of_thought.html-CBreWoS9.js" as="script"><link rel="prefetch" href="/assets/vue_item_with_regard_to_axios_easy_use.html-rUxGTsdR.js" as="script"><link rel="prefetch" href="/assets/vue_mescroll_vscrollfull.html-Cv0wbVOx.js" as="script"><link rel="prefetch" href="/assets/vue_practice_records.html-ZfZQZXZM.js" as="script"><link rel="prefetch" href="/assets/vue_router_history_mode_publish_disposition.html-B9NFtjJ3.js" as="script"><link rel="prefetch" href="/assets/webdev_chii.html-CCAXe0WG.js" as="script"><link rel="prefetch" href="/assets/404.html-DrusccQ9.js" as="script"><link rel="prefetch" href="/assets/index.html-DXoUASTI.js" as="script"><link rel="prefetch" href="/assets/index.html-Bn7w4EOc.js" as="script"><link rel="prefetch" href="/assets/index.html-D5KhUyoe.js" as="script"><link rel="prefetch" href="/assets/index.html-BJFQX8Wn.js" as="script"><link rel="prefetch" href="/assets/index.html-h2FSslzr.js" as="script"><link rel="prefetch" href="/assets/index.html-bMD15Hcg.js" as="script"><link rel="prefetch" href="/assets/index.html-Db1vGCq3.js" as="script"><link rel="prefetch" href="/assets/index.html-BoQxM3KY.js" as="script"><link rel="prefetch" href="/assets/index.html-mw6JLC7l.js" as="script"><link rel="prefetch" href="/assets/index.html-D7YOaRzh.js" as="script"><link rel="prefetch" href="/assets/index.html-DPTwWYRz.js" as="script"><link rel="prefetch" href="/assets/index.html-ny2z-yDS.js" as="script"><link rel="prefetch" href="/assets/index.html-NGmJKqV6.js" as="script"><link rel="prefetch" href="/assets/index.html-TTZS1LZQ.js" as="script"><link rel="prefetch" href="/assets/index.html-mV5bh4Jg.js" as="script"><link rel="prefetch" href="/assets/index.html-B7GbDewX.js" as="script"><link rel="prefetch" href="/assets/index.html-D6z6kHXA.js" as="script"><link rel="prefetch" href="/assets/index.html-D4B6lvyV.js" as="script"><link rel="prefetch" href="/assets/index.html-B6vRnt2f.js" as="script"><link rel="prefetch" href="/assets/index.html-RMs8a4wg.js" as="script"><link rel="prefetch" href="/assets/index.html-DZmkQtHB.js" as="script"><link rel="prefetch" href="/assets/index.html-BeQN0Z-n.js" as="script"><link rel="prefetch" href="/assets/index.html-D_LdpNH9.js" as="script"><link rel="prefetch" href="/assets/index.html-ZdIpzaHu.js" as="script"><link rel="prefetch" href="/assets/index.html-BIAKdwsE.js" as="script"><link rel="prefetch" href="/assets/index.html-D5CZVT4B.js" as="script"><link rel="prefetch" href="/assets/index.html-Dff3fiqD.js" as="script"><link rel="prefetch" href="/assets/index.html-NFrfwXE1.js" as="script"><link rel="prefetch" href="/assets/index.html-CV5c7UX6.js" as="script"><link rel="prefetch" href="/assets/index.html-Dnw4M6ne.js" as="script"><link rel="prefetch" href="/assets/index.html-BSwaa22C.js" as="script"><link rel="prefetch" href="/assets/index.html-CMySzLp-.js" as="script"><link rel="prefetch" href="/assets/index.html-DPCFQYUk.js" as="script"><link rel="prefetch" href="/assets/index.html-DKllXlaU.js" as="script"><link rel="prefetch" href="/assets/index.html-Bki_KSlk.js" as="script"><link rel="prefetch" href="/assets/index.html-dFoPZd9F.js" as="script"><link rel="prefetch" href="/assets/index.html-ZIGAnapo.js" as="script"><link rel="prefetch" href="/assets/index.html-B9OpQClW.js" as="script"><link rel="prefetch" href="/assets/index.html-Cc23ABc_.js" as="script"><link rel="prefetch" href="/assets/index.html-rk4UL7TV.js" as="script"><link rel="prefetch" href="/assets/index.html--b8-6-qD.js" as="script"><link rel="prefetch" href="/assets/index.html-DvhnsKJo.js" as="script"><link rel="prefetch" href="/assets/index.html-BytFJxXZ.js" as="script"><link rel="prefetch" href="/assets/index.html-fHN2IGsT.js" as="script"><link rel="prefetch" href="/assets/index.html-50rczdtU.js" as="script"><link rel="prefetch" href="/assets/index.html-G3ZQudMZ.js" as="script"><link rel="prefetch" href="/assets/index.html-D_CKhMNC.js" as="script"><link rel="prefetch" href="/assets/index.html-CAhqDmO_.js" as="script"><link rel="prefetch" href="/assets/index.html-BmVWa7vZ.js" as="script"><link rel="prefetch" href="/assets/index.html-DiwyrEbO.js" as="script"><link rel="prefetch" href="/assets/index.html-BfIMpSbO.js" as="script"><link rel="prefetch" href="/assets/photoswipe.esm-GXRgw7eJ.js" as="script"><link rel="prefetch" href="/assets/SearchResult-BILvUjC4.js" as="script"><link rel="prefetch" href="/assets/setupDevtools-7MC2TMWH-BqKyTeK3.js" as="script">
  </head>
  <body>
    <div id="app"><!--[--><!--[--><!--[--><span tabindex="-1"></span><a href="#main-content" class="vp-skip-link sr-only">跳至主要內容</a><!--]--><div class="theme-container external-link-icon has-toc" vp-container><!--[--><header id="navbar" class="vp-navbar" vp-navbar><div class="vp-navbar-start"><button type="button" class="vp-toggle-sidebar-button" title="Toggle Sidebar"><span class="icon"></span></button><!----><!--[--><a class="route-link vp-brand" href="/" aria-label="带我回家"><img class="vp-nav-logo" src="/logo.svg" alt><!----><span class="vp-site-name hide-in-pad">易墨网</span></a><!--]--><!----></div><div class="vp-navbar-center"><!----><!--[--><nav class="vp-nav-links"><div class="vp-nav-item hide-in-mobile"><a class="route-link auto-link" href="/" aria-label="易墨网"><!--[--><span class="font-icon icon fa-fw fa-sm fas fa-home" style=""></span><!--]-->易墨网<!----></a></div><div class="vp-nav-item hide-in-mobile"><a class="route-link auto-link" href="/article/" aria-label="文章"><!--[--><span class="font-icon icon fa-fw fa-sm fas fa-book" style=""></span><!--]-->文章<!----></a></div><div class="vp-nav-item hide-in-mobile"><a class="route-link auto-link" href="/timeline/" aria-label="时间轴"><!--[--><span class="font-icon icon fa-fw fa-sm fas fa-timeline" style=""></span><!--]-->时间轴<!----></a></div><div class="vp-nav-item hide-in-mobile"><div class="vp-dropdown-wrapper"><button type="button" class="vp-dropdown-title" aria-label="合集"><!--[--><span class="font-icon icon fa-fw fa-sm fas fa-newspaper" style=""></span>合集<!--]--><span class="arrow"></span><ul class="vp-dropdown"><li class="vp-dropdown-item"><a class="route-link auto-link" href="/posts/admincore/" aria-label="中台项目 Admin.Core"><!--[--><span class="font-icon icon fa-fw fa-sm fas fa-laptop-code" style=""></span><!--]-->中台项目 Admin.Core<!----></a></li><li class="vp-dropdown-item"><a class="route-link route-link-active auto-link" href="/posts/devops/" aria-label="微服务项目 DevOps"><!--[--><span class="font-icon icon fa-fw fa-sm fas fa-laptop-code" style=""></span><!--]-->微服务项目 DevOps<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/posts/developer/" aria-label="日常开发"><!--[--><span class="font-icon icon fa-fw fa-sm fas fa-laptop-code" style=""></span><!--]-->日常开发<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/posts/web/" aria-label="前端开发"><!--[--><span class="font-icon icon fa-fw fa-sm fas fa-laptop-code" style=""></span><!--]-->前端开发<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/posts/docker/" aria-label="Docker"><!--[--><span class="font-icon icon fa-fw fa-sm fas fa-laptop-code" style=""></span><!--]-->Docker<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/posts/dotnetcore/" aria-label="DotNetCore"><!--[--><span class="font-icon icon fa-fw fa-sm fas fa-laptop-code" style=""></span><!--]-->DotNetCore<!----></a></li></ul></button></div></div><div class="vp-nav-item hide-in-mobile"><div class="vp-dropdown-wrapper"><button type="button" class="vp-dropdown-title" aria-label="一些轮子"><!--[--><span class="font-icon icon fa-fw fa-sm fas fa-sliders" style=""></span>一些轮子<!--]--><span class="arrow"></span><ul class="vp-dropdown"><li class="vp-dropdown-item"><a class="auto-link external-link" href="https://coverview.yimo.link" aria-label="CoverView 封面生成器" rel="noopener noreferrer" target="_blank"><!---->CoverView 封面生成器<!----></a></li><li class="vp-dropdown-item"><a class="auto-link external-link" href="https://github.com/yimogit/metools-plugin" aria-label="MeTools 日常工具集" rel="noopener noreferrer" target="_blank"><!---->MeTools 日常工具集<!----></a></li><li class="vp-dropdown-item"><h4 class="vp-dropdown-subtitle">一些尝试</h4><ul class="vp-dropdown-subitems"><li class="vp-dropdown-subitem"><a class="auto-link external-link" href="https://github.com/yimogit/Emo.Dev" aria-label="代码生成器" rel="noopener noreferrer" target="_blank"><!---->代码生成器<!----></a></li><li class="vp-dropdown-subitem"><a class="auto-link external-link" href="https://github.com/yimogit/ExcelDocTxtTemplateReplace" aria-label="模板替换工具" rel="noopener noreferrer" target="_blank"><!---->模板替换工具<!----></a></li><li class="vp-dropdown-subitem"><a class="auto-link external-link" href="https://github.com/yimogit/YimoCustomizedSign" aria-label="一个自动化签到程序" rel="noopener noreferrer" target="_blank"><!---->一个自动化签到程序<!----></a></li><li class="vp-dropdown-subitem"><a class="auto-link external-link" href="https://github.com/yimogit/vue-template" aria-label="vue 模板封装" rel="noopener noreferrer" target="_blank"><!---->vue 模板封装<!----></a></li><li class="vp-dropdown-subitem"><a class="auto-link external-link" href="https://github.com/yimogit/vue-layui" aria-label="vue-layui 封装" rel="noopener noreferrer" target="_blank"><!---->vue-layui 封装<!----></a></li><li class="vp-dropdown-subitem"><a class="auto-link external-link" href="https://github.com/yimogit/me-admin-template" aria-label="vue-ElementUI 模板封装" rel="noopener noreferrer" target="_blank"><!---->vue-ElementUI 模板封装<!----></a></li><li class="vp-dropdown-subitem"><a class="auto-link external-link" href="https://github.com/yimogit/me-admin-sdk" aria-label="vue-ElementUI npm包封装" rel="noopener noreferrer" target="_blank"><!---->vue-ElementUI npm包封装<!----></a></li><li class="vp-dropdown-subitem"><a class="auto-link external-link" href="https://github.com/yimogit/vue-project-summary" aria-label="vue 项目经验总结" rel="noopener noreferrer" target="_blank"><!---->vue 项目经验总结<!----></a></li></ul></li></ul></button></div></div></nav><!--]--><!----></div><div class="vp-navbar-end"><!----><!--[--><!----><div class="vp-nav-item vp-action"><a class="vp-action-link" href="https://github.com/yimogit/yimogit.github.io" target="_blank" rel="noopener noreferrer" aria-label="GitHub"><svg xmlns="http://www.w3.org/2000/svg" class="icon github-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="github icon" name="github" style="width:1.25rem;height:1.25rem;vertical-align:middle;"><path d="M511.957 21.333C241.024 21.333 21.333 240.981 21.333 512c0 216.832 140.544 400.725 335.574 465.664 24.49 4.395 32.256-10.07 32.256-23.083 0-11.69.256-44.245 0-85.205-136.448 29.61-164.736-64.64-164.736-64.64-22.315-56.704-54.4-71.765-54.4-71.765-44.587-30.464 3.285-29.824 3.285-29.824 49.195 3.413 75.179 50.517 75.179 50.517 43.776 75.008 114.816 53.333 142.762 40.79 4.523-31.66 17.152-53.377 31.19-65.537-108.971-12.458-223.488-54.485-223.488-242.602 0-53.547 19.114-97.323 50.517-131.67-5.035-12.33-21.93-62.293 4.779-129.834 0 0 41.258-13.184 134.912 50.346a469.803 469.803 0 0 1 122.88-16.554c41.642.213 83.626 5.632 122.88 16.554 93.653-63.488 134.784-50.346 134.784-50.346 26.752 67.541 9.898 117.504 4.864 129.834 31.402 34.347 50.474 78.123 50.474 131.67 0 188.586-114.73 230.016-224.042 242.09 17.578 15.232 33.578 44.672 33.578 90.454v135.85c0 13.142 7.936 27.606 32.854 22.87C862.25 912.597 1002.667 728.747 1002.667 512c0-271.019-219.648-490.667-490.71-490.667z"></path></svg></a></div><div class="vp-nav-item hide-in-mobile"><button type="button" class="vp-outlook-button" tabindex="-1" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" class="icon outlook-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="outlook icon" name="outlook"><path d="M224 800c0 9.6 3.2 44.8 6.4 54.4 6.4 48-48 76.8-48 76.8s80 41.6 147.2 0 134.4-134.4 38.4-195.2c-22.4-12.8-41.6-19.2-57.6-19.2C259.2 716.8 227.2 761.6 224 800zM560 675.2l-32 51.2c-51.2 51.2-83.2 32-83.2 32 25.6 67.2 0 112-12.8 128 25.6 6.4 51.2 9.6 80 9.6 54.4 0 102.4-9.6 150.4-32l0 0c3.2 0 3.2-3.2 3.2-3.2 22.4-16 12.8-35.2 6.4-44.8-9.6-12.8-12.8-25.6-12.8-41.6 0-54.4 60.8-99.2 137.6-99.2 6.4 0 12.8 0 22.4 0 12.8 0 38.4 9.6 48-25.6 0-3.2 0-3.2 3.2-6.4 0-3.2 3.2-6.4 3.2-6.4 6.4-16 6.4-16 6.4-19.2 9.6-35.2 16-73.6 16-115.2 0-105.6-41.6-198.4-108.8-268.8C704 396.8 560 675.2 560 675.2zM224 419.2c0-28.8 22.4-51.2 51.2-51.2 28.8 0 51.2 22.4 51.2 51.2 0 28.8-22.4 51.2-51.2 51.2C246.4 470.4 224 448 224 419.2zM320 284.8c0-22.4 19.2-41.6 41.6-41.6 22.4 0 41.6 19.2 41.6 41.6 0 22.4-19.2 41.6-41.6 41.6C339.2 326.4 320 307.2 320 284.8zM457.6 208c0-12.8 12.8-25.6 25.6-25.6 12.8 0 25.6 12.8 25.6 25.6 0 12.8-12.8 25.6-25.6 25.6C470.4 233.6 457.6 220.8 457.6 208zM128 505.6C128 592 153.6 672 201.6 736c28.8-60.8 112-60.8 124.8-60.8-16-51.2 16-99.2 16-99.2l316.8-422.4c-48-19.2-99.2-32-150.4-32C297.6 118.4 128 291.2 128 505.6zM764.8 86.4c-22.4 19.2-390.4 518.4-390.4 518.4-22.4 28.8-12.8 76.8 22.4 99.2l9.6 6.4c35.2 22.4 80 12.8 99.2-25.6 0 0 6.4-12.8 9.6-19.2 54.4-105.6 275.2-524.8 288-553.6 6.4-19.2-3.2-32-19.2-32C777.6 76.8 771.2 80 764.8 86.4z"></path></svg><div class="vp-outlook-dropdown"><!----></div></button></div><!--[--><button type="button" class="search-pro-button" aria-label="搜索"><svg xmlns="http://www.w3.org/2000/svg" class="icon search-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="search icon" name="search"><path d="M192 480a256 256 0 1 1 512 0 256 256 0 0 1-512 0m631.776 362.496-143.2-143.168A318.464 318.464 0 0 0 768 480c0-176.736-143.264-320-320-320S128 303.264 128 480s143.264 320 320 320a318.016 318.016 0 0 0 184.16-58.592l146.336 146.368c12.512 12.48 32.768 12.48 45.28 0 12.48-12.512 12.48-32.768 0-45.28"></path></svg><div class="search-pro-placeholder">搜索</div><div class="search-pro-key-hints"><kbd class="search-pro-key">Ctrl</kbd><kbd class="search-pro-key">K</kbd></div></button><!--]--><!--]--><!----><button type="button" class="vp-toggle-navbar-button" aria-label="Toggle Navbar" aria-expanded="false" aria-controls="nav-screen"><span><span class="vp-top"></span><span class="vp-middle"></span><span class="vp-bottom"></span></span></button></div></header><!----><!--]--><!----><div class="toggle-sidebar-wrapper"><span class="arrow start"></span></div><aside id="sidebar" class="vp-sidebar" vp-sidebar><!----><ul class="vp-sidebar-links"><li><a class="route-link auto-link vp-sidebar-link" href="/posts/devops/" aria-label="微服务项目 DevOps"><!--[--><span class="font-icon icon fa-fw fa-sm fas fa-laptop-code" style=""></span><!--]-->微服务项目 DevOps<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/posts/devops/devops_hyperv_centos_install.html" aria-label="Hyper-V 安装 CentOS 8.5"><!---->Hyper-V 安装 CentOS 8.5<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/posts/devops/devops_docker24_composev2_install.html" aria-label="Docker V24 及 Docker Compose V2 的安装及使用"><!---->Docker V24 及 Docker Compose V2 的安装及使用<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/posts/devops/devops_docker_mysql_mongo.html" aria-label="Docker Compose V2 安装常用数据库MySQL+Mongo"><!---->Docker Compose V2 安装常用数据库MySQL+Mongo<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/posts/devops/devops_docker_clickhouse_install.html" aria-label="Docker Compose V2 安装 ClickHouse v20.6.8.5 经验分享"><!---->Docker Compose V2 安装 ClickHouse v20.6.8.5 经验分享<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/posts/devops/devops_docker_redis_cluster_install.html" aria-label="Docker 安装 Redis 单机&amp;集群总结"><!---->Docker 安装 Redis 单机&amp;集群总结<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/posts/devops/devops_apollo_install.html" aria-label="Apollo 配置中心的部署与使用经验"><!---->Apollo 配置中心的部署与使用经验<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/posts/devops/devops_dns_dnserver_install_use.html" aria-label="一个基于.NET7的开源DNS服务 DnsServer 的部署使用经验分享"><!---->一个基于.NET7的开源DNS服务 DnsServer 的部署使用经验分享<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/posts/devops/devops_nexus3_nuget_docker_install_use.html" aria-label="一篇适合躺收藏夹的 Nexus3 搭建 NuGet&amp;Docker 私有库的安装使用总结"><!---->一篇适合躺收藏夹的 Nexus3 搭建 NuGet&amp;Docker 私有库的安装使用总结<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/posts/devops/devops_jumpserver_install_use.html" aria-label="提升运维效率：轻松掌握JumpServer安装和使用技巧"><!---->提升运维效率：轻松掌握JumpServer安装和使用技巧<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/posts/devops/devops_prometheus_grafana_install_use_db_site_monitor.html" aria-label="Prometheus+Grafana 监控平台实践-搭建&amp;常用服务监控&amp;告警"><!---->Prometheus+Grafana 监控平台实践-搭建&amp;常用服务监控&amp;告警<!----></a></li><li><a class="route-link route-link-active auto-link vp-sidebar-link active" href="/posts/devops/devops_k8s_install_use.html" aria-label="一篇可供参考的 K8S 落地实践经验"><!---->一篇可供参考的 K8S 落地实践经验<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/posts/devops/devops_docker_to_nexus_deploy_k8s_use.html" aria-label="构建 dotnet&amp;vue 应用镜像-&gt;推送到 Nexus 仓库-&gt;部署为 k8s 服务实践"><!---->构建 dotnet&amp;vue 应用镜像-&gt;推送到 Nexus 仓库-&gt;部署为 k8s 服务实践<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/posts/devops/devops_docker_elk_install_nginx_config.html" aria-label="使用 Docker Compose V2 快速搭建日志分析平台 ELK (Elasticsearch、Logstash 和 Kibana)"><!---->使用 Docker Compose V2 快速搭建日志分析平台 ELK (Elasticsearch、Logstash 和 Kibana)<!----></a></li></ul><!----></aside><!--[--><main id="main-content" class="vp-page"><!--[--><!----><!----><nav class="vp-breadcrumb disable"></nav><div class="vp-page-title"><h1><!---->一篇可供参考的 K8S 落地实践经验</h1><div class="page-info"><span class="page-author-info" aria-label="作者🖊" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon author-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="author icon" name="author"><path d="M649.6 633.6c86.4-48 147.2-144 147.2-249.6 0-160-128-288-288-288s-288 128-288 288c0 108.8 57.6 201.6 147.2 249.6-121.6 48-214.4 153.6-240 288-3.2 9.6 0 19.2 6.4 25.6 3.2 9.6 12.8 12.8 22.4 12.8h704c9.6 0 19.2-3.2 25.6-12.8 6.4-6.4 9.6-16 6.4-25.6-25.6-134.4-121.6-240-243.2-288z"></path></svg><span><a class="page-author-item" href="https://www.yimo.link" target="_blank" rel="noopener noreferrer">易墨</a></span><span property="author" content="易墨"></span></span><!----><span class="page-date-info" aria-label="写作日期📅" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon calendar-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="calendar icon" name="calendar"><path d="M716.4 110.137c0-18.753-14.72-33.473-33.472-33.473-18.753 0-33.473 14.72-33.473 33.473v33.473h66.993v-33.473zm-334.87 0c0-18.753-14.72-33.473-33.473-33.473s-33.52 14.72-33.52 33.473v33.473h66.993v-33.473zm468.81 33.52H716.4v100.465c0 18.753-14.72 33.473-33.472 33.473a33.145 33.145 0 01-33.473-33.473V143.657H381.53v100.465c0 18.753-14.72 33.473-33.473 33.473a33.145 33.145 0 01-33.473-33.473V143.657H180.6A134.314 134.314 0 0046.66 277.595v535.756A134.314 134.314 0 00180.6 947.289h669.74a134.36 134.36 0 00133.94-133.938V277.595a134.314 134.314 0 00-133.94-133.938zm33.473 267.877H147.126a33.145 33.145 0 01-33.473-33.473c0-18.752 14.72-33.473 33.473-33.473h736.687c18.752 0 33.472 14.72 33.472 33.473a33.145 33.145 0 01-33.472 33.473z"></path></svg><span data-allow-mismatch="text">2023年12月26日</span><meta property="datePublished" content="2023-12-26T08:38:00.000Z"></span><!----><span class="page-reading-time-info" aria-label="阅读时间⌛" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon timer-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="timer icon" name="timer"><path d="M799.387 122.15c4.402-2.978 7.38-7.897 7.38-13.463v-1.165c0-8.933-7.38-16.312-16.312-16.312H256.33c-8.933 0-16.311 7.38-16.311 16.312v1.165c0 5.825 2.977 10.874 7.637 13.592 4.143 194.44 97.22 354.963 220.201 392.763-122.204 37.542-214.893 196.511-220.2 389.397-4.661 5.049-7.638 11.651-7.638 19.03v5.825h566.49v-5.825c0-7.379-2.849-13.981-7.509-18.9-5.049-193.016-97.867-351.985-220.2-389.527 123.24-37.67 216.446-198.453 220.588-392.892zM531.16 450.445v352.632c117.674 1.553 211.787 40.778 211.787 88.676H304.097c0-48.286 95.149-87.382 213.728-88.676V450.445c-93.077-3.107-167.901-81.297-167.901-177.093 0-8.803 6.99-15.793 15.793-15.793 8.803 0 15.794 6.99 15.794 15.793 0 80.261 63.69 145.635 142.01 145.635s142.011-65.374 142.011-145.635c0-8.803 6.99-15.793 15.794-15.793s15.793 6.99 15.793 15.793c0 95.019-73.789 172.82-165.96 177.093z"></path></svg><span>大约 15 分钟</span><meta property="timeRequired" content="PT15M"></span><span class="page-category-info" aria-label="分类🌈" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon category-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="category icon" name="category"><path d="M148.41 106.992h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H148.41c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.311-40.31zM147.556 553.478H429.73c22.263 0 40.311 18.048 40.311 40.31v282.176c0 22.263-18.048 40.312-40.31 40.312H147.555c-22.263 0-40.311-18.049-40.311-40.312V593.79c0-22.263 18.048-40.311 40.31-40.311zM593.927 106.992h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H593.927c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.31-40.31zM730.22 920.502H623.926c-40.925 0-74.22-33.388-74.22-74.425V623.992c0-41.038 33.387-74.424 74.425-74.424h222.085c41.038 0 74.424 33.226 74.424 74.067v114.233c0 10.244-8.304 18.548-18.547 18.548s-18.548-8.304-18.548-18.548V623.635c0-20.388-16.746-36.974-37.33-36.974H624.13c-20.585 0-37.331 16.747-37.331 37.33v222.086c0 20.585 16.654 37.331 37.126 37.331H730.22c10.243 0 18.547 8.304 18.547 18.547 0 10.244-8.304 18.547-18.547 18.547z"></path></svg><!--[--><span class="page-category-item color2 clickable" role="navigation">DevOps</span><!--]--><meta property="articleSection" content="DevOps"></span><span class="page-tag-info" aria-label="标签🏷" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon tag-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="tag icon" name="tag"><path d="M939.902 458.563L910.17 144.567c-1.507-16.272-14.465-29.13-30.737-30.737L565.438 84.098h-.402c-3.215 0-5.726 1.005-7.634 2.913l-470.39 470.39a10.004 10.004 0 000 14.164l365.423 365.424c1.909 1.908 4.42 2.913 7.132 2.913s5.223-1.005 7.132-2.913l470.39-470.39c2.01-2.11 3.014-5.023 2.813-8.036zm-240.067-72.121c-35.458 0-64.286-28.828-64.286-64.286s28.828-64.285 64.286-64.285 64.286 28.828 64.286 64.285-28.829 64.286-64.286 64.286z"></path></svg><!--[--><span class="page-tag-item color7 clickable" role="navigation">devops</span><span class="page-tag-item color5 clickable" role="navigation">k8s</span><!--]--><meta property="keywords" content="devops,k8s"></span></div><hr></div><div class="vp-toc-placeholder"><aside id="toc" vp-toc><!----><div class="vp-toc-header">此页内容<button type="button" class="print-button" title="打印"><svg xmlns="http://www.w3.org/2000/svg" class="icon print-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="print icon" name="print"><path d="M819.2 364.8h-44.8V128c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v236.8h-44.8C145.067 364.8 96 413.867 96 473.6v192c0 59.733 49.067 108.8 108.8 108.8h44.8V896c0 17.067 14.933 32 32 32h460.8c17.067 0 32-14.933 32-32V774.4h44.8c59.733 0 108.8-49.067 108.8-108.8v-192c0-59.733-49.067-108.8-108.8-108.8zM313.6 160h396.8v204.8H313.6V160zm396.8 704H313.6V620.8h396.8V864zM864 665.6c0 25.6-19.2 44.8-44.8 44.8h-44.8V588.8c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v121.6h-44.8c-25.6 0-44.8-19.2-44.8-44.8v-192c0-25.6 19.2-44.8 44.8-44.8h614.4c25.6 0 44.8 19.2 44.8 44.8v192z"></path></svg></button><div class="arrow end"></div></div><div class="vp-toc-wrapper"><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#前言">前言</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#虚拟机准备">虚拟机准备</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#centos8-5-设置固定-ip">CentOS8.5 设置固定 IP</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#centos8-5-联网检查">CentOS8.5 联网检查</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#centos8-5-设置主机名">CentOS8.5 设置主机名</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#确保每个节点上-mac-地址的唯一性">确保每个节点上 MAC 地址的唯一性</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#确保-product-uuid-的唯一性">确保 product_uuid 的唯一性</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#确保-machine-id-的唯一性">确保 Machine ID 的唯一性</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#检查端口是否被占用">检查端口是否被占用</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#安装-k8s-v1-18-8">安装 K8S v1.18.8</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#节点初始化">节点初始化</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#安装kubeadm-kubelet-kubectl">安装kubeadm&amp;kubelet&amp;kubectl</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#安装容器">安装容器</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#设置节点网络的别名">设置节点网络的别名</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#初始化集群">初始化集群</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#安装网络插件-flannel">安装网络插件 flannel</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#worker节点配置">worker节点配置</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#安装-dashboard-v2-0-3">安装 Dashboard v2.0.3</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#安装-metrics-server-v0-3-7">安装 Metrics Server v0.3.7</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#安装-helm-v3-13-1">安装 Helm v3.13.1</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#使用-k8s-集群部署服务">使用 K8S 集群部署服务</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#常用命令">常用命令</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#部署一个-nginx-服务">部署一个 nginx 服务</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#使用-ingress-nginx-v3-41进行服务负载">使用 Ingress-Nginx v3.41进行服务负载</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#准备">准备</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#安装">安装</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#使用">使用</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#踩坑记录">踩坑记录</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#相关文档">相关文档</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#后语">后语</a></li><!----><!--]--></ul><div class="vp-toc-marker" style="top:-1.7rem;"></div></div><!----></aside></div><!----><div class="theme-hope-content" vp-content><h2 id="前言" tabindex="-1"><a class="header-anchor" href="#前言"><span>前言</span></a></h2><blockquote><p>k8s 即 Kubernetes，是一个开源的容器编排引擎，用来对容器化应用进行自动化部署、 扩缩和管理<br> 本篇文章将分享 k8s v1.18.8 的安装，以及其面板，监控，部署服务，使用Ingress-Ningx进行负载均衡的实践<br> 因为公司用的这个老版本，并且后面要负责搭建，担心无法复刻，趁此周末，实践一二，确认可行，遂与君分享。</p></blockquote><h2 id="虚拟机准备" tabindex="-1"><a class="header-anchor" href="#虚拟机准备"><span>虚拟机准备</span></a></h2><ul><li>宿主机：Windows10</li><li>虚拟机工具：Hyper-V 10.0.19041.1</li><li>虚拟机 Linux 系统：CentOS 8.5</li><li>已安装软件：docker (v2.21.0)及 docker compose(24.0.6)</li><li>Hyper-V虚拟机一览</li></ul><figure><img src="/assets/662652-20231224221252676-1766144377-yW_J3zNs.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><ul><li>IP 及主机名</li></ul><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>192.168.123.100 master</span></span>
<span class="line"><span>192.168.123.101 worker01</span></span>
<span class="line"><span>192.168.123.102 worker02</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="centos8-5-设置固定-ip" tabindex="-1"><a class="header-anchor" href="#centos8-5-设置固定-ip"><span>CentOS8.5 设置固定 IP</span></a></h3><ul><li>设置IP及网关：<code>vi /etc/sysconfig/network-scripts/ifcfg-eth0</code></li></ul><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>TYPE=Ethernet</span></span>
<span class="line"><span>PROXY_METHOD=none</span></span>
<span class="line"><span>BROWSER_ONLY=no</span></span>
<span class="line"><span>DEFROUTE=yes</span></span>
<span class="line"><span>IPV4_FAILURE_FATAL=no</span></span>
<span class="line"><span>IPV6INIT=yes</span></span>
<span class="line"><span>IPV6_AUTOCONF=yes</span></span>
<span class="line"><span>IPV6_DEFROUTE=yes</span></span>
<span class="line"><span>IPV6_FAILURE_FATAL=no</span></span>
<span class="line"><span>NAME=eth0</span></span>
<span class="line"><span>DEVICE=eth0</span></span>
<span class="line"><span>ONBOOT=yes</span></span>
<span class="line"><span>PREFIX=24</span></span>
<span class="line"><span>IPV6_PRIVACY=no</span></span>
<span class="line"><span># 设置IP及网关</span></span>
<span class="line"><span>BOOTPROTO=static</span></span>
<span class="line"><span>IPADDR=192.168.123.100</span></span>
<span class="line"><span>GATEWAY=192.168.123.1</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="centos8-5-联网检查" tabindex="-1"><a class="header-anchor" href="#centos8-5-联网检查"><span>CentOS8.5 联网检查</span></a></h3><ul><li>配置好网络后先测试 curl 是否可以正常访问网络<code> curl ``http://mirrors.aliyun.com</code>，如果提示：<code> curl: (6) Could not resolve host: ``mirrors.aliyun.com</code> ，则需要检查dns设置</li><li><code>cat /etc/resolv.conf</code> 默认应该是网关的地址，也可以自行修改为其他公共dns</li></ul><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>nameserver 192.168.123.1</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h3 id="centos8-5-设置主机名" tabindex="-1"><a class="header-anchor" href="#centos8-5-设置主机名"><span>CentOS8.5 设置主机名</span></a></h3><ul><li>查看主机信息：<code>hostnamectl</code>，通过导入虚拟机创建的主机信息除了mac地址其他基本都一样</li><li>设置主机名：<code>hostnamectl set-hostname 主机名</code></li></ul><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span># 查看hostname</span></span>
<span class="line"><span>hostnamectl --static</span></span>
<span class="line"><span>#设置 hostname 对应机器设置</span></span>
<span class="line"><span># 192.168.123.100</span></span>
<span class="line"><span>hostnamectl set-hostname master</span></span>
<span class="line"><span># 192.168.123.101</span></span>
<span class="line"><span>hostnamectl set-hostname worker01</span></span>
<span class="line"><span># 192.168.123.102</span></span>
<span class="line"><span>hostnamectl set-hostname worker02</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="确保每个节点上-mac-地址的唯一性" tabindex="-1"><a class="header-anchor" href="#确保每个节点上-mac-地址的唯一性"><span>确保每个节点上 MAC 地址的唯一性</span></a></h3><p>可以在外部使用 PowerShell 查看 Hyper-V 虚拟机的地址，在导入时选择新注册会自动生成 Mac 地址，无需更改</p><ul><li>centos8.5 查看mac地址：<code>ip link show dev eth0</code></li></ul><figure><img src="/assets/662652-20231224221252593-915957863-D4Hag4AY.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><ul><li>外部使用 PowerShell 查看：<code>(Get-VMNetworkAdapter -VMName &quot;k8s-master&quot;).MacAddress</code></li></ul><figure><img src="/assets/662652-20231224221252584-1526366459-RXNj228d.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><h3 id="确保-product-uuid-的唯一性" tabindex="-1"><a class="header-anchor" href="#确保-product-uuid-的唯一性"><span>确保 product_uuid 的唯一性</span></a></h3><ul><li>执行 <code>sudo cat /sys/class/dmi/id/product_uuid</code> 查看<code>product_uuid</code> 我这里因为都是复制的虚拟机，查出来是一样的的，所以需要修改</li></ul><figure><img src="/assets/662652-20231224221252629-1383913254-DxR2MdJB.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><ul><li>修改需要关闭虚拟机后执行PowerShell脚本 ，<a href="https://www.cnblogs.com/morang/p/hyper-v-uuid-change-powershell-script.html" target="_blank" rel="noopener noreferrer">文章总结</a></li><li>外部查看Hyper-V虚拟机 UUID</li></ul><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>Get-VM &quot;k8s-master&quot; | % { (gwmi -Namespace root\virtualization\v2 -Class msvm_computersystem -Filter (&#39;ElementName=&quot;{0}&quot;&#39; -f $_.Name)).GetRelated(&#39;msvm_virtualsystemsettingdata&#39;) | select BIOSGUID }</span></span>
<span class="line"><span>Get-VM &quot;k8s-worker01&quot; | % { (gwmi -Namespace root\virtualization\v2 -Class msvm_computersystem -Filter (&#39;ElementName=&quot;{0}&quot;&#39; -f $_.Name)).GetRelated(&#39;msvm_virtualsystemsettingdata&#39;) | select BIOSGUID }</span></span>
<span class="line"><span>Get-VM &quot;k8s-worker02&quot; | % { (gwmi -Namespace root\virtualization\v2 -Class msvm_computersystem -Filter (&#39;ElementName=&quot;{0}&quot;&#39; -f $_.Name)).GetRelated(&#39;msvm_virtualsystemsettingdata&#39;) | select BIOSGUID }</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>PowerShell 修改 Hyper-V虚拟机 UUID</li></ul><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>#这里假设虚拟机的VMname是k8s-master，自行替换即可</span></span>
<span class="line"><span>$VMname=&quot;k8s-master&quot;</span></span>
<span class="line"><span>$vmx = Get-WmiObject -Namespace root\virtualization\v2 -Class msvm_virtualsystemsettingdata </span></span>
<span class="line"><span>#每次操作选择一台虚拟机</span></span>
<span class="line"><span>$CurrentSettingsData = $vmx | Where-Object { $_.ElementName -eq $VMname }</span></span>
<span class="line"><span>#检查一下老的GUID</span></span>
<span class="line"><span>$CurrentSettingsData.BIOSGUID</span></span>
<span class="line"><span>#生成新GUID</span></span>
<span class="line"><span>$GUID = [System.Guid]::NewGuid()</span></span>
<span class="line"><span>#重新写入GUID，注意要带{}，这是非常重要的细节</span></span>
<span class="line"><span>$CurrentSettingsData.BIOSGUID = &quot;{&quot; + $GUID.Guid.ToUpper() + &quot;}&quot; </span></span>
<span class="line"><span>#生成一个ModifySystemSettings的空对象</span></span>
<span class="line"><span>$VMMS = Get-WmiObject -Namespace root\virtualization\v2 -Class msvm_virtualsystemmanagementservice</span></span>
<span class="line"><span>$ModifySystemSettingsParams = $VMMS.GetMethodParameters(&#39;ModifySystemSettings&#39;)</span></span>
<span class="line"><span>#配置这个属性，需要特殊的转换方式</span></span>
<span class="line"><span>$ModifySystemSettingsParams.SystemSettings = $CurrentSettingsData.GetText([System.Management.TextFormat]::CimDtd20)</span></span>
<span class="line"><span>#写入</span></span>
<span class="line"><span>$VMMS.InvokeMethod(&#39;ModifySystemSettings&#39;, $ModifySystemSettingsParams, $null)</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>开机后查询可以看到已经修改成功</li></ul><figure><img src="/assets/662652-20231224221252663-882439839-B4dVaE0s.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><h3 id="确保-machine-id-的唯一性" tabindex="-1"><a class="header-anchor" href="#确保-machine-id-的唯一性"><span>确保 Machine ID 的唯一性</span></a></h3><ul><li>执行 <code>/etc/machine-id</code> 或使用 hostnamectl 发现机器id是一样的</li></ul><figure><img src="/assets/662652-20231224221252613-1220781311-CK23yO_S.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><ul><li>重新生成了机器id</li></ul><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>sudo cp /etc/machine-id /etc/machine-id.backup</span></span>
<span class="line"><span>sudo rm /etc/machine-id</span></span>
<span class="line"><span>sudo systemd-machine-id-setup</span></span>
<span class="line"><span>cat /etc/machine-id</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>执行结果</li></ul><figure><img src="/assets/662652-20231224221252710-478069305-DBPvvcmG.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><h3 id="检查端口是否被占用" tabindex="-1"><a class="header-anchor" href="#检查端口是否被占用"><span>检查端口是否被占用</span></a></h3><figure><img src="/assets/662652-20231224221252716-805428728-B2-18c-U.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><ul><li>centos8.5 使用 ss 查询端口是否使用</li></ul><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>ss -tuln | grep -E &quot;6443|2379|2380|10250|10259|10257|30000-32767&quot;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><ul><li>执行结果,无占用</li></ul><figure><img src="/assets/662652-20231224221252689-2049707927-DALMpeB1.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><h2 id="安装-k8s-v1-18-8" tabindex="-1"><a class="header-anchor" href="#安装-k8s-v1-18-8"><span>安装 K8S v1.18.8</span></a></h2><p>都2023年了，为什么还是 v1.18.8？</p><p>因为公司用的这个版本，并且后面要负责搭建，趁此周末，实践一二，确认可行，遂与君分享。</p><h3 id="节点初始化" tabindex="-1"><a class="header-anchor" href="#节点初始化"><span>节点初始化</span></a></h3><ul><li><strong>执行主机：</strong> <strong>master</strong> <strong>,worker01,worker02</strong></li><li>关闭防火墙</li><li>关闭swap分区</li><li>允许 iptables 检查桥接流量</li><li>添加阿里云 yum 源</li></ul><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span># 关闭防火墙</span></span>
<span class="line"><span>systemctl stop firewalld</span></span>
<span class="line"><span># 设置永久不开启防火墙</span></span>
<span class="line"><span>systemctl disable firewalld</span></span>
<span class="line"><span></span></span>
<span class="line"><span># 关闭swap 分区 </span></span>
<span class="line"><span>swapoff -a   </span></span>
<span class="line"><span>#永久关闭</span></span>
<span class="line"><span>sed -ri &#39;s/.*swap.*/#&amp;/&#39; /etc/fstab</span></span>
<span class="line"><span></span></span>
<span class="line"><span># 将 SELinux 设置为 permissive 模式（相当于将其禁用）</span></span>
<span class="line"><span>setenforce 0</span></span>
<span class="line"><span>sed -i &#39;s/^SELINUX=enforcing$/SELINUX=permissive/&#39; /etc/selinux/config</span></span>
<span class="line"><span></span></span>
<span class="line"><span># 允许 iptables 检查桥接流量</span></span>
<span class="line"><span>cat &gt; /etc/sysctl.d/k8s.conf &lt;&lt; EOF</span></span>
<span class="line"><span>net.bridge.bridge-nf-call-ip6tables = 1</span></span>
<span class="line"><span>net.bridge.bridge-nf-call-iptables = 1</span></span>
<span class="line"><span>net.ipv4.ip_forward = 1</span></span>
<span class="line"><span>EOF</span></span>
<span class="line"><span></span></span>
<span class="line"><span># 添加阿里云 yum 源</span></span>
<span class="line"><span>cat &gt; /etc/yum.repos.d/kubernetes.repo &lt;&lt; EOF</span></span>
<span class="line"><span>[kubernetes]</span></span>
<span class="line"><span>name=Kubernetes</span></span>
<span class="line"><span>baseurl=https://mirrors.aliyun.com/kubernetes/yum/repos/kubernetes-el7-x86_64</span></span>
<span class="line"><span>enabled=1</span></span>
<span class="line"><span>gpgcheck=0</span></span>
<span class="line"><span>repo_gpgcheck=0</span></span>
<span class="line"><span>gpgkey=https://mirrors.aliyun.com/kubernetes/yum/doc/yum-key.gpg https://mirrors.aliyun.com/kubernetes/yum/doc/rpm-package-key.gpg</span></span>
<span class="line"><span>EOF</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="安装kubeadm-kubelet-kubectl" tabindex="-1"><a class="header-anchor" href="#安装kubeadm-kubelet-kubectl"><span>安装kubeadm&amp;kubelet&amp;kubectl</span></a></h3><ul><li><strong>执行主机：</strong> <strong>master</strong> <strong>,worker01,worker02</strong></li><li><code>kubeadm</code>：用来初始化集群的指令。</li><li><code>kubelet</code>：在集群中的每个节点上用来启动 Pod 和容器等。</li><li><code>kubectl</code>：用来与集群通信的命令行工具。</li></ul><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span># 安装</span></span>
<span class="line"><span>yum install -y kubeadm-1.18.8 kubelet-1.18.8 kubectl-1.18.8 ipvsadm</span></span>
<span class="line"><span># 自启</span></span>
<span class="line"><span>sudo systemctl enable --now kubelet</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><p>验证是否安装完成</p><ul><li><code>kubelet --version</code></li><li><code>kubeadm version</code></li><li><code>kubectl version</code></li></ul></li></ul><h3 id="安装容器" tabindex="-1"><a class="header-anchor" href="#安装容器"><span>安装容器</span></a></h3><ul><li><strong>执行主机：</strong> <strong>master</strong> <strong>,worker01,worker02</strong></li></ul><p>在 Docker 19.x 版本之前，Docker 使用自己的容器运行时（称为 Docker Runtime）。从 Docker 19.x 版本开始，Docker Engine 开始使用 containerd 作为默认的容器运行时，以提供更稳定、可靠的容器管理功能。</p><ul><li>k8s v1.18.8 版本，安装docker v24 暂未遇到问题</li><li>判断是否启用:<code>systemctl status containerd</code></li><li>安装docker及container</li></ul><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>curl -o /etc/yum.repos.d/CentOS-Base.repo https://mirrors.aliyun.com/repo/Centos-vault-8.5.2111.repo</span></span>
<span class="line"><span>rm /etc/yum.repos.d/CentOS-Linux-AppStream.repo -f</span></span>
<span class="line"><span>rm /etc/yum.repos.d/CentOS-Linux-BaseOS.repo -f</span></span>
<span class="line"><span>dnf clean all</span></span>
<span class="line"><span>sudo yum install -y yum-utils device-mapper-persistent-data lvm2</span></span>
<span class="line"><span>sudo yum-config-manager --add-repo https://download.docker.com/linux/centos/docker-ce.repo</span></span>
<span class="line"><span>sudo yum install -y docker-ce-3:24.0.0-1.el8 docker-ce-cli-1:24.0.6-1.el8 containerd.io docker-buildx-plugin docker-compose-plugin</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>可参考 <a href="https://juejin.cn/post/7283873796977197108" target="_blank" rel="noopener noreferrer">Docker V24 及 Docker Compose V2 的安装及使用</a></p><h3 id="设置节点网络的别名" tabindex="-1"><a class="header-anchor" href="#设置节点网络的别名"><span>设置节点网络的别名</span></a></h3><ul><li><strong>执行主机：</strong> <strong>master</strong> <strong>,worker01,worker02</strong></li></ul><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>cat &gt;&gt; /etc/hosts &lt;&lt; EOF</span></span>
<span class="line"><span>192.168.123.100 master</span></span>
<span class="line"><span>192.168.123.101 worker01</span></span>
<span class="line"><span>192.168.123.102 worker02</span></span>
<span class="line"><span>EOF</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="初始化集群" tabindex="-1"><a class="header-anchor" href="#初始化集群"><span>初始化集群</span></a></h3><ul><li><strong>执行主机：</strong> <strong>master</strong></li><li>--apiserver-advertise-address：指定通讯节点，使用master节点即可</li><li>--image-repository：k8s官网镜像库</li><li>--service-cidr: svc网络的ip段设置</li><li>--pod-network-cidr:pod的ip段配置，每个pod都会有自己的ip <a href="https://github.com/flannel-io/flannel/blob/master/Documentation/kube-flannel.yml" target="_blank" rel="noopener noreferrer">kube-flannel.yml</a> 默认 10.244.0.0/16</li></ul><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>kubeadm init \</span></span>
<span class="line"><span>  --apiserver-advertise-address=192.168.123.100 \</span></span>
<span class="line"><span>  --image-repository registry.aliyuncs.com/google_containers \</span></span>
<span class="line"><span>  --kubernetes-version v1.18.8 \</span></span>
<span class="line"><span>  --service-cidr=10.10.0.0/16 \</span></span>
<span class="line"><span>  --pod-network-cidr=10.244.0.0/16 \</span></span>
<span class="line"><span>  --ignore-preflight-errors=all</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>执行结果，创建成功</li></ul><figure><img src="/assets/662652-20231224221252703-364126435-CPvknbFc.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><ul><li>输出结果如下</li></ul><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>您的Kubernetes控制平面已成功初始化！</span></span>
<span class="line"><span></span></span>
<span class="line"><span>要开始使用集群，非root用户需要使用以下操作：</span></span>
<span class="line"><span></span></span>
<span class="line"><span>  mkdir -p $HOME/.kube</span></span>
<span class="line"><span>  sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config</span></span>
<span class="line"><span>  sudo chown $(id -u):$(id -g) $HOME/.kube/config</span></span>
<span class="line"><span></span></span>
<span class="line"><span>您现在应该向集群部署一个pod网络。</span></span>
<span class="line"><span>Run &quot;kubectl apply -f [podnetwork].yaml&quot; with one of the options listed at:</span></span>
<span class="line"><span>  https://kubernetes.io/docs/concepts/cluster-administration/addons/</span></span>
<span class="line"><span>  </span></span>
<span class="line"><span>然后，您可以通过以root身份在每个工作节点上运行以下操作来加入任意数量的工作节点：</span></span>
<span class="line"><span>kubeadm join 192.168.123.100:6443 --token nn9das.wslckjkd1ng3oxui \</span></span>
<span class="line"><span>    --discovery-token-ca-cert-hash sha256:7b3f413e6bfbd1f91448460426a144741bd14c2bb3119cfa058d07d65ab329fd</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>配置集群身份验证文件</li></ul><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>  mkdir -p $HOME/.kube</span></span>
<span class="line"><span>  sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config</span></span>
<span class="line"><span>  sudo chown $(id -u):$(id -g) $HOME/.kube/config</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>若不配置直接使用 kubectl 相关命令会提示：<code>The connection to the server ``localhost:8080`` was refused - did you specify the right host or port?</code></p><p>想要在哪里管理k8s 就要将 .kube 文件夹拷贝到目标主机，即工作节点需要复制 .kube 目录到 $HOME 目录中</p><h3 id="安装网络插件-flannel" tabindex="-1"><a class="header-anchor" href="#安装网络插件-flannel"><span>安装网络插件 flannel</span></a></h3><ul><li>下载 <a href="https://github.com/flannel-io/flannel/blob/master/Documentation/kube-flannel.yml" target="_blank" rel="noopener noreferrer">kube-flannel.yml</a></li><li>若初始化时指定了 --pod-network-cidr 则需要修改配置中 net-conf.json:Network 项</li><li>执行安装</li></ul><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>kubectl apply -f https://raw.githubusercontent.com/coreos/flannel/master/Documentation/kube-flannel.yml --insecure-skip-tls-verify</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h3 id="worker节点配置" tabindex="-1"><a class="header-anchor" href="#worker节点配置"><span>worker节点配置</span></a></h3><ul><li><strong>执行主机：worker01,worker02</strong></li><li>根据前面的 环境设置，k8s工具安装，docker安装，在worker节点也执行，进行初始化</li><li>将worker节点加入集群：执行master初始化后输出的join命令</li></ul><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>kubeadm join 192.168.123.100:6443 --token e270ma.bjeg9k1g3e5k1q2h \</span></span>
<span class="line"><span>    --discovery-token-ca-cert-hash sha256:7beaa6a51994a7d63544ba1d410504ffe8e58a66746c507d3ff09dd15244a813</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>若找不到或失效可通过：<code>kubeadm token create --print-join-command</code>重新生成join命令</li><li>复制 master 节点的k8s配置文件 $HOME/.kube/config 到工作节点</li><li>安装网络插件 flannel</li></ul><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>khttps://raw.githubusercontent.com/coreos/flannel/master/Documentation/kube-flannel.yml --insecure-skip-tls-verify</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h2 id="安装-dashboard-v2-0-3" tabindex="-1"><a class="header-anchor" href="#安装-dashboard-v2-0-3"><span>安装 Dashboard v2.0.3</span></a></h2><blockquote><p>Kubernetes Dashboard 是一个用于管理和监控 Kubernetes 集群的 Web 用户界面。它提供了一个直观的图形界面，可以帮助你查看和管理集群中的各种资源、部署应用程序、监控集群状态等</p></blockquote><ul><li><a href="https://github.com/kubernetes/dashboard" target="_blank" rel="noopener noreferrer">官方仓库</a></li><li>执行 <a href="https://github.com/kubernetes/dashboard/blob/v2.0.4/aio/deploy/recommended.yaml" target="_blank" rel="noopener noreferrer">recommended.yaml</a>, 安装面板，完全支持的版本为 <a href="https://github.com/kubernetes/dashboard/releases/tag/v2.0.3" target="_blank" rel="noopener noreferrer">v2.0.3</a></li></ul><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>kubectl apply -f https://raw.githubusercontent.com/kubernetes/dashboard/v2.0.3/aio/deploy/recommended.yaml</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><ul><li>若需要修改token默认15分钟的过期时间为7天，修改对应参数即可</li></ul><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>args:</span></span>
<span class="line"><span>- --auto-generate-certificates</span></span>
<span class="line"><span>- --namespace=kubernetes-dashboard</span></span>
<span class="line"><span>- --token-ttl=604800</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>默认创建的 kubernetes-dashboard 无权限，所以需要授权，这里直接创建使用命令创建一个新用户 admin 并授权</li><li>创建用户</li></ul><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>cat &lt;&lt;EOF | kubectl apply -f -</span></span>
<span class="line"><span>apiVersion: v1</span></span>
<span class="line"><span>kind: ServiceAccount</span></span>
<span class="line"><span>metadata:</span></span>
<span class="line"><span>  name: admin</span></span>
<span class="line"><span>  namespace: kubernetes-dashboard</span></span>
<span class="line"><span>EOF</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>角色授权</li></ul><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>cat &lt;&lt;EOF | kubectl apply -f -</span></span>
<span class="line"><span>apiVersion: rbac.authorization.k8s.io/v1</span></span>
<span class="line"><span>kind: ClusterRoleBinding</span></span>
<span class="line"><span>metadata:</span></span>
<span class="line"><span>  name: admin</span></span>
<span class="line"><span>roleRef:</span></span>
<span class="line"><span>  apiGroup: rbac.authorization.k8s.io</span></span>
<span class="line"><span>  kind: ClusterRole</span></span>
<span class="line"><span>  name: cluster-admin</span></span>
<span class="line"><span>subjects:</span></span>
<span class="line"><span>- kind: ServiceAccount</span></span>
<span class="line"><span>  name: admin</span></span>
<span class="line"><span>  namespace: kubernetes-dashboard</span></span>
<span class="line"><span>EOF</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>获取登陆token</li></ul><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>kubectl -n kubernetes-dashboard describe secret $(kubectl -n kubernetes-dashboard get secret | grep kubernetes-dashboard| awk &#39;{print $1}&#39;)</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>[root@master ~]# kubectl -n kubernetes-dashboard describe secret $(kubectl -n kubernetes-dashboard get secret | grep admin | awk &#39;{print $1}&#39;)</span></span>
<span class="line"><span>Name:         admin-token-4nqqz</span></span>
<span class="line"><span>Namespace:    kubernetes-dashboard</span></span>
<span class="line"><span>Labels:       &lt;none&gt;</span></span>
<span class="line"><span>Annotations:  kubernetes.io/service-account.name: admin</span></span>
<span class="line"><span>              kubernetes.io/service-account.uid: 6f432133-5007-4d8b-9239-8c55efa03826</span></span>
<span class="line"><span></span></span>
<span class="line"><span>Type:  kubernetes.io/service-account-token</span></span>
<span class="line"><span></span></span>
<span class="line"><span>Data</span></span>
<span class="line"><span>====</span></span>
<span class="line"><span>ca.crt:     1025 bytes</span></span>
<span class="line"><span>namespace:  20 bytes</span></span>
<span class="line"><span>token:      eyJhbGciOiJSUzI1NiIsImtpZCI6IlUycUl0Zmpnb0Y4Z2FWXzVkbmtjSjR6UngwNW05Z0tDcjVydklLWURYY1EifQ.eyJpc3MiOiJrdWJlcm5ldGVzL3NlcnZpY2VhY2NvdW50Iiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9uYW1lc3BhY2UiOiJrdWJlcm5ldGVzLWRhc2hib2FyZCIsImt1YmVybmV0ZXMuaW8vc2VydmljZWFjY291bnQvc2VjcmV0Lm5hbWUiOiJhZG1pbi10b2tlbi00bnFxeiIsImt1YmVybmV0ZXMuaW8vc2VydmljZWFjY291bnQvc2VydmljZS1hY2NvdW50Lm5hbWUiOiJhZG1pbiIsImt1YmVybmV0ZXMuaW8vc2VydmljZWFjY291bnQvc2VydmljZS1hY2NvdW50LnVpZCI6IjZmNDMyMTMzLTUwMDctNGQ4Yi05MjM5LThjNTVlZmEwMzgyNiIsInN1YiI6InN5c3RlbTpzZXJ2aWNlYWNjb3VudDprdWJlcm5ldGVzLWRhc2hib2FyZDphZG1pbiJ9.J8nXyfpWjs9IbnvdfrW5hSq5SkCWy16NL89nphiDk-UGZP0qbcx0xQG_IfmTUfO0lxDQdD84VyZ8EzLENtwtqt3oIVZQyyyUAonOzqnAUfN3l9Jd_uFVbZhS_tfnwC3p4z2htUpDfXNLFoA4hav-2EgT6wY3voIZtnarfNvvBCBCimi-pG4AcCvc34V_udpYRXYpP1IPswS82NMTBVt_T1Y8gm_zKwq8LH6Z4LYr6wdr3MxGT4Fr7H5GK1jVS_wbna06HEK-GI_szNf5u-zRTMP5Si4JOHxnEWwHH4keLG6ez0pwkk5jYTqncczeb91Es_zZE95rvLxn1yh2mzAP5g</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>暴露到集群外</li></ul><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>kubectl patch svc kubernetes-dashboard -n kubernetes-dashboard -p &#39;{&quot;spec&quot;:{&quot;type&quot;:&quot;NodePort&quot;,&quot;ports&quot;:[{&quot;port&quot;:443,&quot;targetPort&quot;:8443,&quot;nodePort&quot;:30001}]}}&#39;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><ul><li>使用 Chrome 访问：https://192.168.123.102:30001/#/login</li></ul><figure><img src="/assets/662652-20231224221252736-435736867-Dxrfwymu.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><ul><li>因为要求必须要使用https，所以结合之前文章**<a href="https://www.cnblogs.com/morang/p/devops-nginx-install-use.html" target="_blank" rel="noopener noreferrer">前后端都用得上的 Nginx 日常使用经验</a>**，生成证书并添加域名配置</li></ul><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>server {</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    listen 80;</span></span>
<span class="line"><span>    listen       443 ssl;</span></span>
<span class="line"><span>    server_name k8s.devops.test.com;  # 自行修改成你的域名</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    ssl_certificate      /certs/k8s.devops.test.com/server.crt;</span></span>
<span class="line"><span>    ssl_certificate_key  /certs/k8s.devops.test.com/server.key;</span></span>
<span class="line"><span>    ssl_session_cache    shared:SSL:1m;</span></span>
<span class="line"><span>    ssl_session_timeout  5m;</span></span>
<span class="line"><span>    ssl_ciphers  HIGH:!aNULL:!MD5;</span></span>
<span class="line"><span>    ssl_prefer_server_ciphers  on;</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    location / {</span></span>
<span class="line"><span>            proxy_pass https://192.168.123.100:30001;</span></span>
<span class="line"><span>            proxy_http_version 1.1;</span></span>
<span class="line"><span>            proxy_buffering off;</span></span>
<span class="line"><span>            proxy_request_buffering off;</span></span>
<span class="line"><span>            proxy_set_header Upgrade $http_upgrade;</span></span>
<span class="line"><span>            proxy_set_header Connection &quot;upgrade&quot;;</span></span>
<span class="line"><span>            proxy_set_header Host $host;</span></span>
<span class="line"><span>            proxy_set_header X-Forwarded-For $remote_addr;</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>成功使用https+域名访问</li></ul><figure><img src="/assets/662652-20231224221252709-1081319541-BLPuJAI4.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><ul><li>升级面板版本 v2.2.0，可以更好的显示 ingress 相关信息</li></ul><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span># 删除pod</span></span>
<span class="line"><span>kubectl -n kubernetes-dashboard delete $(kubectl -n kubernetes-dashboard get pod -o name | grep dashboard)</span></span>
<span class="line"><span># 重新部署v2.2.0</span></span>
<span class="line"><span>kubectl apply -f https://raw.githubusercontent.com/kubernetes/dashboard/v2.2.0/aio/deploy/recommended.yaml</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="安装-metrics-server-v0-3-7" tabindex="-1"><a class="header-anchor" href="#安装-metrics-server-v0-3-7"><span>安装 Metrics Server v0.3.7</span></a></h2><blockquote><p>Metrics Server 是一个用于收集集群中各个组件的资源使用情况和性能指标数据的组件。安装后可以在面板中或使用命令 kubectl top node 查看集群使用情况</p></blockquote><ul><li><p><a href="https://github.com/kubernetes-sigs/metrics-server" target="_blank" rel="noopener noreferrer">官方仓库</a></p></li><li><p>k8s v1.18 对应可以使用 <a href="https://github.com/kubernetes-sigs/metrics-server/tree/v0.3.7/deploy" target="_blank" rel="noopener noreferrer">v0.3.7</a> 部署文件 metrics-server/deploy/1.8+/</p></li><li><p>修改配置 metrics-server-deployment.yaml</p><ul><li>修改镜像源：<code>registry.aliyuncs.com/google_containers</code></li><li>新增command配置跳过证书的验证： <code>-kubelet-insecure-tls</code></li><li>设置首选通信类型：<code>--kubelet-preferred-address-types=InternalDNS,InternalIP,ExternalDNS,ExternalIP,Hostname</code></li></ul></li></ul><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span># ...</span></span>
<span class="line"><span>spec:</span></span>
<span class="line"><span>      serviceAccountName: metrics-server</span></span>
<span class="line"><span>      volumes:</span></span>
<span class="line"><span>      # mount in tmp so we can safely use from-scratch images and/or read-only containers</span></span>
<span class="line"><span>      - name: tmp-dir</span></span>
<span class="line"><span>        emptyDir: {}</span></span>
<span class="line"><span>      containers:</span></span>
<span class="line"><span>      - name: metrics-server</span></span>
<span class="line"><span>        # 修改镜像源 image: k8s.gcr.io/metrics-server/metrics-server:v0.3.7</span></span>
<span class="line"><span>        image: registry.aliyuncs.com/google_containers/metrics-server:v0.3.7</span></span>
<span class="line"><span>        imagePullPolicy: IfNotPresent</span></span>
<span class="line"><span>        # 新增command配置</span></span>
<span class="line"><span>        command:</span></span>
<span class="line"><span>        - /metrics-server</span></span>
<span class="line"><span>        # 跳过 Kubernetes API Server 对 Kubelet TLS 证书的验证</span></span>
<span class="line"><span>        - --kubelet-insecure-tls</span></span>
<span class="line"><span>        # 通信时首选的地址类型</span></span>
<span class="line"><span>        - --kubelet-preferred-address-types=InternalDNS,InternalIP,ExternalDNS,ExternalIP,Hostname</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>拷贝文件到服务器或直接在master节点修改</li><li>到考本文件的目录执行命令安装即可</li></ul><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>cd /app/k8s/</span></span>
<span class="line"><span>kubectl apply -f metrics-server-0.3.7/deploy/1.8+/</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>目录结构及修改</li></ul><figure><img src="/assets/662652-20231224221252710-2137788827-DnOMLZ7F.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><ul><li>执行成功</li></ul><figure><img src="/assets/662652-20231224221252699-1638896453-DjHDVjtu.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><ul><li>等待pod部署成功后刷新页面可以看到监控就出来了</li></ul><figure><img src="/assets/662652-20231224221252721-27097896-Cggt01Zq.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><figure><img src="/assets/662652-20231224221252733-612408733-C7kkZ4e4.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><ul><li>使用 <code>kubectl top node</code>查看节点资源使用情况</li></ul><figure><img src="/assets/662652-20231224221252691-373556356-Btu5u_gu.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><ul><li>使用 <code>kubectl top pod -A</code> 查看 Pod 资源使用情况</li></ul><h2 id="安装-helm-v3-13-1" tabindex="-1"><a class="header-anchor" href="#安装-helm-v3-13-1"><span>安装 Helm v3.13.1</span></a></h2><blockquote><p>Kubernetes Helm 是一个包管理工具，用于在 Kubernetes 环境中简化应用程序的部署和管理。Helm 允许你定义、安装和升级 Kubernetes 应用程序的预定义软件包，这些软件包称为 Helm Charts。</p></blockquote><ul><li><a href="https://github.com/helm/helm" target="_blank" rel="noopener noreferrer">官方仓库</a></li><li>安装v3版本</li></ul><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>curl https://raw.githubusercontent.com/helm/helm/master/scripts/get-helm-3 | bash</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><ul><li>安装成功，版本为 v3.13.1</li></ul><figure><img src="/assets/662652-20231224221252744-1299430260-uFAkuHWH.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><ul><li>安装目录：/usr/local/bin/helm</li><li>可以看到有一个警告说没有安装git, 因为 Helm 在安装插件(<a href="https://github.com/chartmuseum/helm-push" target="_blank" rel="noopener noreferrer">push插件</a>)时需要使用 Git，所以可以顺手安装一下 git</li></ul><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>sudo dnf install git -y</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><ul><li>查看Helm仓库列表：<code>helm repo list</code> ，默认为空，如果要按照什么应用，需要添加对应的仓库</li><li>helm 搜索应用：<code>helm search repo ingress-nginx/ingress-nginx --version=&#39;&lt;4&#39;</code></li><li>helm 卸载应用：<code>helm uninstall -n ingress-nginx ingress-nginx</code></li><li>具体使用可参考下面安装 ingress-nginx</li><li>在 Helm 中修改镜像源需要使用 <code>--set</code> 或 <code>--set-string</code> 参数来覆盖默认值。对于 Nginx Ingress Controller，可以通过指定 <code>controller.image.repository</code> 和 <code>controller.image.tag</code> 来修改镜像源的包地址和版本。这个在安装ingress-nginx就有使用，在无法使用官方镜像的时候一般都需要替换为国内镜像</li></ul><h2 id="使用-k8s-集群部署服务" tabindex="-1"><a class="header-anchor" href="#使用-k8s-集群部署服务"><span>使用 K8S 集群部署服务</span></a></h2><h3 id="常用命令" tabindex="-1"><a class="header-anchor" href="#常用命令"><span>常用命令</span></a></h3><ul><li>部署服务：<code>kubectl apply -f 配置文件名.yml</code></li><li>查看副本集信息：<code>kubectl get replicasets</code></li></ul><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>[root@master tests]# kubectl get replicasets</span></span>
<span class="line"><span>NAME                  DESIRED   CURRENT   READY   AGE</span></span>
<span class="line"><span>my-nginx-69448bd7d9   2         2         2       36m</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>查看 Deployment 信息：<code>kubectl describe deployments my-nginx</code></li></ul><figure><img src="/assets/662652-20231224221252713-2086538077-BG7KCS8n.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><ul><li>查看 Service 信息：<code>kubectl get services my-nginx-service</code></li></ul><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>[root@master tests]# kubectl get services my-nginx-service</span></span>
<span class="line"><span>NAME               TYPE       CLUSTER-IP      EXTERNAL-IP   PORT(S)        AGE</span></span>
<span class="line"><span>my-nginx-service   NodePort   10.10.143.180   &lt;none&gt;        80:30080/TCP   35m</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>集群中可以使用此服务IP进行通讯</p><figure><img src="/assets/662652-20231224221252684-2046522162-CZL7YSdN.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><ul><li>查看部署的 nginx 服务的 Pod :<code>kubectl get pods --selector=app=my-nginx</code></li></ul><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>[root@master tests]# kubectl get pods --selector=app=my-nginx</span></span>
<span class="line"><span>NAME                        READY   STATUS    RESTARTS   AGE</span></span>
<span class="line"><span>my-nginx-69448bd7d9-q8xtl   1/1     Running   0          39m</span></span>
<span class="line"><span>my-nginx-69448bd7d9-zghxb   1/1     Running   0          30m</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>删除服务：<code>kubectl delete services my-nginx-service</code></li><li>删除负载：<code>kubectl delete deployment my-nginx</code></li></ul><h3 id="部署一个-nginx-服务" tabindex="-1"><a class="header-anchor" href="#部署一个-nginx-服务"><span>部署一个 nginx 服务</span></a></h3><ul><li>配置一个简单的 nginx 服务：nginx.yml</li><li>部署了 Deployment 和 Service</li><li>暴露了容器的端口：80</li><li>暴露集群外的端口：30080</li><li>设置了2个副本：<code>replicas: 2</code></li><li>完整配置文件</li></ul><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>apiVersion: apps/v1</span></span>
<span class="line"><span>kind: Deployment</span></span>
<span class="line"><span>metadata:</span></span>
<span class="line"><span>  name: my-nginx</span></span>
<span class="line"><span>spec:</span></span>
<span class="line"><span>  replicas: 2</span></span>
<span class="line"><span>  selector:</span></span>
<span class="line"><span>    matchLabels:</span></span>
<span class="line"><span>      app: my-nginx</span></span>
<span class="line"><span>  template:</span></span>
<span class="line"><span>    metadata:</span></span>
<span class="line"><span>      labels:</span></span>
<span class="line"><span>        app: my-nginx</span></span>
<span class="line"><span>    spec:</span></span>
<span class="line"><span>      containers:</span></span>
<span class="line"><span>        - name: my-nginx</span></span>
<span class="line"><span>          image: nginx:latest</span></span>
<span class="line"><span>          ports:</span></span>
<span class="line"><span>            - containerPort: 80</span></span>
<span class="line"><span>---</span></span>
<span class="line"><span>apiVersion: v1</span></span>
<span class="line"><span>kind: Service</span></span>
<span class="line"><span>metadata:</span></span>
<span class="line"><span>  name: my-nginx-service</span></span>
<span class="line"><span>spec:</span></span>
<span class="line"><span>  selector:</span></span>
<span class="line"><span>    app: my-nginx</span></span>
<span class="line"><span>  type: NodePort</span></span>
<span class="line"><span>  ports:</span></span>
<span class="line"><span>    - protocol: TCP</span></span>
<span class="line"><span>      port: 80</span></span>
<span class="line"><span>      targetPort: 80</span></span>
<span class="line"><span>      nodePort: 30080</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>上传到服务器执行：<code>kubectl apply -f nginx.yml</code></li><li>部署成功后使用节点IP+端口号即可访问</li></ul><figure><img src="/assets/662652-20231224221252690-1293840678-D2L-rm1o.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><ul><li>目前部署了两个服务，但是可以目前没有能够设置负载的地方，所以还需要一个 Ingress 控制器来管理流量和负载均衡</li></ul><h2 id="使用-ingress-nginx-v3-41进行服务负载" tabindex="-1"><a class="header-anchor" href="#使用-ingress-nginx-v3-41进行服务负载"><span>使用 Ingress-Nginx v3.41进行服务负载</span></a></h2><blockquote><p>Kubernetes 默认使用的负载均衡算法是基于 IP 的轮询（IP-based round-robin），它会将请求按照源 IP 地址的顺序分发到不同的 Pod 上。如果需要其他负载均衡算法，可以使用 Ingress 控制器或者自定义的负载均衡解决方案</p><p>如果使用 Kubernetes 1.19 或更高版本，可以使用最新版本的 NGINX Ingress Controller;</p><p>如果使用旧版本的 Kubernetes（1.18 或更早版本），则必须使用 Ingress-Nginx Controller 的 0.X 版本（例如 0.49 版本</p></blockquote><h3 id="准备" tabindex="-1"><a class="header-anchor" href="#准备"><span>准备</span></a></h3><ul><li><a href="https://github.com/kubernetes/ingress-nginx" target="_blank" rel="noopener noreferrer">官方仓库</a></li><li><a href="https://kubernetes.github.io/ingress-nginx/deploy/#running-on-kubernetes-versions-older-than-119" target="_blank" rel="noopener noreferrer">版本选择说明</a></li><li>ArtifactHub： <a href="https://artifacthub.io/packages/helm/ingress-nginx/ingress-nginx/3.41.0" target="_blank" rel="noopener noreferrer">v3.41</a></li><li>使用 helm 查找 ingress-nginx 包</li></ul><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span># 查询仓库列表</span></span>
<span class="line"><span>helm repo list</span></span>
<span class="line"><span># 添加仓库地址</span></span>
<span class="line"><span>helm repo add ingress-nginx https://kubernetes.github.io/ingress-nginx</span></span>
<span class="line"><span># 搜索包</span></span>
<span class="line"><span>helm search repo ingress-nginx/ingress-nginx --version=&#39;&lt;4&#39;</span></span>
<span class="line"><span># ingress-nginx/ingress-nginx     3.41.0          0.51.0          Ingress controller for Kubernetes using NGINX a</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="安装" tabindex="-1"><a class="header-anchor" href="#安装"><span>安装</span></a></h3><ul><li>创建 namespace</li></ul><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>kubectl create namespace ingress-nginx</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><ul><li>安装 ingress-nginx 源下的 v3.41 版本 ingress-nginx, 指定 namespace 为 ingress-nginx,指定镜像源为阿里云</li></ul><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>helm install ingress-nginx ingress-nginx/ingress-nginx --namespace ingress-nginx --version 3.41.0 --set controller.image.repository=registry.aliyuncs.com/google_containers/nginx-ingress-controller</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><ul><li>如果安装后报错负载无法启动，可能是因为包无法拉取，可指定镜像源 <code>--set controller.image.repository</code> 为国内源(registry.aliyuncs.com/google_containers/nginx-ingress-controller) 重新安装（卸载 <code>helm uninstall -n ingress-nginx ingress-nginx</code>）即可</li><li>安装成功，并给出提示应该如何使用</li></ul><figure><img src="/assets/662652-20231224221252754-1045178623-BiO_AqMX.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><ul><li><p>如果需要在局域网中使用，还需要修改两个配置</p></li><li><p>修改负载 ingress-nginx-controller 配置 保存后生效</p><ul><li><code>dnsPolicy: ClusterFirstWithHostNet</code> 策略将首先尝试使用主机的 DNS 解析服务来解析域名，如果主机的 DNS 无法解析该域名，将会尝试使用其他配置的 DNS 解析器</li><li><code>hostNetwork:true</code> Pod 中的容器将使用主机的网络栈和网络配置</li></ul></li></ul><figure><img src="/assets/662652-20231224221252930-72349938-B7XoM9P4.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><h3 id="使用" tabindex="-1"><a class="header-anchor" href="#使用"><span>使用</span></a></h3><ul><li>通过 Dashboard 右上角直接创建 YAML 文件</li></ul><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>apiVersion: extensions/v1beta1</span></span>
<span class="line"><span>kind: Ingress</span></span>
<span class="line"><span>metadata:</span></span>
<span class="line"><span>  name: ingress-nginx-test</span></span>
<span class="line"><span>  namespace: default</span></span>
<span class="line"><span>spec:</span></span>
<span class="line"><span>  rules:</span></span>
<span class="line"><span>  - host: nginx.k8stest.com</span></span>
<span class="line"><span>    http:</span></span>
<span class="line"><span>      paths:</span></span>
<span class="line"><span>      - backend:</span></span>
<span class="line"><span>          serviceName: my-nginx-service</span></span>
<span class="line"><span>          servicePort: 80</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>保存后将会转发域名请求到前面部署的 my-nginx-service 服务中，此时将使用 ingress-nginx 进行负载，当然，还需要将域名解析到目标服务器，本地局域网可以使用 hosts 或者 dns 设置</li><li>通过 <code>kubectl describe pod ingress-nginx-controller -n ingress-nginx</code> 可获取到ingress-nginx所在节点信息，IP为 192.168.123.102</li></ul><figure><img src="/assets/662652-20231224221252704-1718555845-CeIipAo-.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><ul><li>设置 hosts <code> 192.168.123.102 nginx.k8stest.com</code>,再刷新下dns缓存 <code>ipconfig /flushdns</code>访问即可，每次刷新都会请求到不同的pod上面</li></ul><figure><img src="/assets/662652-20231224221252699-424047647-rAn_fY3c.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>至此，在局域网中安装使用 k8s v1.18.8,并进行相关配置已经完成，得益与大佬们的分享，耗时两天，边弄边记，优化了一些步骤与细节。后续将尝试安装更新的版本，敬请期待。</p><h2 id="踩坑记录" tabindex="-1"><a class="header-anchor" href="#踩坑记录"><span>踩坑记录</span></a></h2><ul><li>使用yum安装kubeadm时报错，测试发现curl无法使用，错误如下，需要检查设置dns:<code>cat /etc/resolv.conf</code> 写入默认配置或公告dns: nameserver 192.168.123.1</li></ul><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>[root@master ~]# yum install -y kubeadm-1.18.8 kubelet-1.18.8 kubectl-1.18.8 ipvsadm</span></span>
<span class="line"><span>Repository extras is listed more than once in the configuration</span></span>
<span class="line"><span>CentOS-8.5.2111 - Base - mirrors.aliyun.com                                                                                                                  0.0  B/s |   0  B     00:00</span></span>
<span class="line"><span>Errors during downloading metadata for repository &#39;base&#39;:</span></span>
<span class="line"><span>  - Curl error (6): Couldn&#39;t resolve host name for http://mirrors.aliyun.com/centos-vault/8.5.2111/BaseOS/x86_64/os/repodata/repomd.xml [Could not resolve host: mirrors.aliyun.com]</span></span>
<span class="line"><span>  - Curl error (6): Couldn&#39;t resolve host name for http://mirrors.aliyuncs.com/centos-vault/8.5.2111/BaseOS/x86_64/os/repodata/repomd.xml [Could not resolve host: mirrors.aliyuncs.com]</span></span>
<span class="line"><span>  - Curl error (6): Couldn&#39;t resolve host name for http://mirrors.cloud.aliyuncs.com/centos-vault/8.5.2111/BaseOS/x86_64/os/repodata/repomd.xml [Could not resolve host: mirrors.cloud.aliyuncs.com]</span></span>
<span class="line"><span>Error: Failed to download metadata for repo &#39;base&#39;: Cannot download repomd.xml: Cannot download repodata/repomd.xml: All mirrors were tried</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>阿里云镜像源的使用，指定镜像源时需要使用 <code>registry.aliyuncs.com/google_containers/metrics-server:v0.3.7</code></li><li>helm 安装 ingress-nginx 报错，看是否是因为包拉不下来，可以通过指定镜像源重新安装（卸载 <code>helm uninstall -n ingress-nginx ingress-nginx</code>）即可：k8s v1.18.8 安装 ingress-nginx:<code>helm install ingress-nginx ingress-nginx/ingress-nginx --namespace ingress-nginx --version 3.41.0 --set controller.image.repository=``registry.aliyuncs.com/google_containers/nginx-ingress-controller</code></li></ul><figure><img src="/assets/662652-20231224221252761-1073116118-BIsQC82k.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><h2 id="相关文档" tabindex="-1"><a class="header-anchor" href="#相关文档"><span>相关文档</span></a></h2><ul><li>官方文档 <ul><li><a href="https://kubernetes.io/zh-cn/docs/setup/" target="_blank" rel="noopener noreferrer">k8s官方文档</a></li><li><a href="https://kubernetes.github.io/ingress-nginx/deploy/#running-on-kubernetes-versions-older-than-119" target="_blank" rel="noopener noreferrer">在低于 1.19 的 Kubernetes 版本上运行 ingress-nginx的说明</a></li></ul></li><li>参考 <ul><li><a href="https://qiuyadongsite.github.io/2019/01/03/framework3-microService-k8s1/" target="_blank" rel="noopener noreferrer">k8s安装与试验</a></li><li><a href="https://www.cnblogs.com/binghe001/p/12823763.html" target="_blank" rel="noopener noreferrer">K8S 1.18.2安装dashboard</a></li><li><a href="https://www.cnblogs.com/hsyw/p/17804493.html" target="_blank" rel="noopener noreferrer">Ingress-Nginx部署</a></li></ul></li><li>相关推荐 <ul><li><a href="https://juejin.cn/post/7283798251404738560" target="_blank" rel="noopener noreferrer">Hyper-V 安装 CentOS 8.5</a></li><li><a href="https://juejin.cn/post/7283873796977197108" target="_blank" rel="noopener noreferrer">Docker V24 及 Docker Compose V2 的安装及使用</a></li><li><a href="https://juejin.cn/post/7296754422750232576" target="_blank" rel="noopener noreferrer">前后端都用得上的 Nginx 日常使用经验</a></li></ul></li></ul><h2 id="后语" tabindex="-1"><a class="header-anchor" href="#后语"><span>后语</span></a></h2><blockquote><p>前前后后尝试了好几次搭建k8s,之前基本都看着这座大山，望而却步，各种理由而终止。当时21立的flag，终于是在这2023的末尾给实现了。</p><p>不积硅步 无以至千里，与君共勉</p></blockquote></div><!----><footer class="vp-page-meta"><div class="vp-meta-item edit-link"><a class="auto-link external-link vp-meta-label" href="https://github.com/yimogit/yimogit.github.io/edit/main/src/posts/devops/devops_k8s_install_use.md" aria-label="编辑此页" rel="noopener noreferrer" target="_blank"><!--[--><svg xmlns="http://www.w3.org/2000/svg" class="icon edit-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="edit icon" name="edit"><path d="M430.818 653.65a60.46 60.46 0 0 1-50.96-93.281l71.69-114.012 7.773-10.365L816.038 80.138A60.46 60.46 0 0 1 859.225 62a60.46 60.46 0 0 1 43.186 18.138l43.186 43.186a60.46 60.46 0 0 1 0 86.373L588.879 565.55l-8.637 8.637-117.466 68.234a60.46 60.46 0 0 1-31.958 11.229z"></path><path d="M728.802 962H252.891A190.883 190.883 0 0 1 62.008 771.98V296.934a190.883 190.883 0 0 1 190.883-192.61h267.754a60.46 60.46 0 0 1 0 120.92H252.891a69.962 69.962 0 0 0-69.098 69.099V771.98a69.962 69.962 0 0 0 69.098 69.098h475.911A69.962 69.962 0 0 0 797.9 771.98V503.363a60.46 60.46 0 1 1 120.922 0V771.98A190.883 190.883 0 0 1 728.802 962z"></path></svg><!--]-->编辑此页<!----></a></div><div class="vp-meta-item git-info"><!----><div class="contributors"><span class="vp-meta-label">贡献者: </span><!--[--><!--[--><span class="vp-meta-info" title="email: yimo@wikiglobal.com">yimo</span><!--]--><!--]--></div></div></footer><nav class="vp-page-nav"><a class="route-link auto-link prev" href="/posts/devops/devops_prometheus_grafana_install_use_db_site_monitor.html" aria-label="Prometheus+Grafana 监控平台实践-搭建&amp;常用服务监控&amp;告警"><div class="hint"><span class="arrow start"></span>上一页</div><div class="link"><!---->Prometheus+Grafana 监控平台实践-搭建&amp;常用服务监控&amp;告警</div></a><a class="route-link auto-link next" href="/posts/devops/devops_docker_to_nexus_deploy_k8s_use.html" aria-label="构建 dotnet&amp;vue 应用镜像-&gt;推送到 Nexus 仓库-&gt;部署为 k8s 服务实践"><div class="hint">下一页<span class="arrow end"></span></div><div class="link">构建 dotnet&amp;vue 应用镜像-&gt;推送到 Nexus 仓库-&gt;部署为 k8s 服务实践<!----></div></a></nav><!----><!----><!--]--></main><!--]--><footer class="vp-footer-wrapper" vp-footer><div class="vp-footer">欢迎来到易墨网！</div><div class="vp-copyright">Copyright © 2024 易墨 </div></footer></div><!--]--><!--[--><!----><!----><!--[--><!--]--><!--]--><!--]--></div>
    <script type="module" src="/assets/app-BJhRIsgW.js" defer></script>
  </body>
</html>
